<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Forecasting with ARMA models – Time Series Econometrics (TSE)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./TSE-ch9.html" rel="next">
<link href="./TSE-ch7.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<!-- Use JavaScript to Disable Right-Click -->
<script>
document.addEventListener('contextmenu', event => event.preventDefault());
</script>

<!-- Custom JavaScript for toggling code visibility -->
<script>
function toggleCode(id) {
  var x = document.getElementById(id);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>


<!-- Visibility selections. display: none;? 
  <style>

/* Initially hide elements */
.marginnotevideo {
  display: none;
}

.marginnote {
  display: none;
}

  </style>
-->
</head><body class="nav-sidebar docked">\usepackage{amsmath}
\newcommand{\ubar}[1]{\mkern3mu\underline{\mkern-3mu#1\mkern-3mu}\mkern3mu}

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles-TSE.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./TSE-ch8.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Time Series Econometrics (TSE)</a> 
        <div class="sidebar-tools-main">
    <a href="./msTSE2025.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Time Series Econometrics (TSE)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A primer on time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ARMA processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Parameter estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch8.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Volatility modelling: AR-GARCH model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multivariate time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Basics of vector autoregression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Nonstationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear regressions with I(1) variables</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#properties-of-the-conditional-expectation" id="toc-properties-of-the-conditional-expectation" class="nav-link active" data-scroll-target="#properties-of-the-conditional-expectation"><span class="header-section-number">9.1</span> Properties of the conditional expectation</a></li>
  <li><a href="#ennusteidenmuodostus" id="toc-ennusteidenmuodostus" class="nav-link" data-scroll-target="#ennusteidenmuodostus"><span class="header-section-number">9.2</span> Forming forecasts</a></li>
  <li><a href="#prediction-intervals" id="toc-prediction-intervals" class="nav-link" data-scroll-target="#prediction-intervals"><span class="header-section-number">9.3</span> Prediction intervals</a></li>
  <li><a href="#introduction-to-out-of-sample-forecasting" id="toc-introduction-to-out-of-sample-forecasting" class="nav-link" data-scroll-target="#introduction-to-out-of-sample-forecasting"><span class="header-section-number">9.4</span> Introduction to out-of-sample forecasting</a></li>
  <li><a href="#r-lab" id="toc-r-lab" class="nav-link" data-scroll-target="#r-lab"><span class="header-section-number">9.5</span> R Lab</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="part-ch8" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="properties-of-the-conditional-expectation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="properties-of-the-conditional-expectation"><span class="header-section-number">9.1</span> Properties of the conditional expectation</h2>
<p>Before considering forecasting with an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process, we examine a general situation where the objective is to forecast the (scalar) random variable <span class="math inline">\(Y\)</span> using the realized value <span class="math inline">\(\boldsymbol{X}=\boldsymbol{x}\)</span> of a random vector <span class="math inline">\(\boldsymbol{X}\)</span>. A result from probability theory tells us that the optimal forecast, in the sense of minimized mean square forecast error, is the conditional expected value of <span class="math inline">\(Y\)</span> given <span class="math inline">\(\boldsymbol{X}=\boldsymbol{x}\)</span>. In other words, <span class="math display">\[\begin{equation*}
    \mathsf{E}\left[\left(Y-\mathsf{E}\left(Y\left\vert \boldsymbol{X}=\boldsymbol{x}\right.\right)\right)^{2}\right]\leq\mathsf{E}\left[\left(Y-g\left(\boldsymbol{x}\right)\right)^{2}\right]
\end{equation*}\]</span> for any function <span class="math inline">\(g\left(\boldsymbol{x}\right)\)</span> of <span class="math inline">\(\boldsymbol{x}\)</span> (assuming the expectations above are finite).</p>
<div class="toggle-button" onclick="toggleCode('Extra11')">
Extra: Some details on the conditional expectation
</div>
<div id="Extra11" style="display:none;">
<p>In the case of continuous distributions, the conditional expectation of <span class="math inline">\(Y\)</span> given <span class="math inline">\(\boldsymbol{X} = \boldsymbol{x}\)</span> is defined by the equation <span class="math display">\[\begin{equation*}
    \mathsf{E}\left(Y\left\vert \boldsymbol{X} = \boldsymbol{x} \right.\right)=\int_{-\infty}^{\infty}yf_{Y|\boldsymbol{X}}\left(y; \boldsymbol{x} \right)dy=\int_{-\infty}^{\infty}y\frac{f_{Y,\boldsymbol{X}} \left(y,\boldsymbol{x}\right)}{f_{\boldsymbol{X}}\left(\boldsymbol{x}\right)}dy,
\end{equation*}\]</span> where</p>
<ul>
<li><p><span class="math inline">\(f_{Y,\boldsymbol{X}}\left(y, \boldsymbol{x}\right)\)</span> is the joint density function of the random vector <span class="math inline">\(\left(Y,\boldsymbol{X} \right)\)</span>,</p></li>
<li><p><span class="math inline">\(f_{\boldsymbol{X}}\left(\boldsymbol{x} \right)=\int_{-\infty }^{\infty}f_{Y,\boldsymbol{X}}\left(y,\boldsymbol{x}\right) dy\)</span> is the marginal density function of <span class="math inline">\(\boldsymbol{X}\)</span>, and</p></li>
<li><p><span class="math inline">\(f_{Y|\boldsymbol{X}}\left(y;\boldsymbol{x}\right)=f_{Y,\boldsymbol{X}}\left(y,\boldsymbol{x} \right)/f_{\boldsymbol{X}}\left(\boldsymbol{x} \right)\)</span> defines the conditional density function of <span class="math inline">\(Y\)</span> given <span class="math inline">\(\boldsymbol{X} = \boldsymbol{x}\)</span>.</p></li>
</ul>
<p>When <span class="math inline">\(\boldsymbol{x}\)</span> varies over the possible values of the random vector <span class="math inline">\(\boldsymbol{X}\)</span>, <span class="math inline">\(\mathsf{E}\left(Y\left\vert \boldsymbol{X} = \boldsymbol{x} \right.\right)\)</span> as a function of <span class="math inline">\(\boldsymbol{x}\)</span> defines a random variable for which it is natural to use the notation <span class="math inline">\(\mathsf{E}\left(Y\left\vert \boldsymbol{X} \right.\right)\)</span>.</p>
<!-- - In fact, in more advanced probability theory, conditional expectation is directly defined as a particular random variable.  -->
</div>
<p>The above definition can be generalized to the case where the random vector <span class="math inline">\(\boldsymbol{X}\)</span> might be infinite-dimensional. This case will be encountered in the ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) context assuming that all the values of the process <span class="math inline">\(\left\{y_{t},\text{ }t=0,\pm1,\ldots\right\}\)</span> that precede the <strong>forecast origin</strong> (the time when the forecast is constructed) are known.</p>
<p>For our purposes, it suffices to know some simple properties of the conditional expected value (which also hold in the case of an infinite-dimensional conditioning variable). In this course, we will use the following properties of the conditional expected value:</p>
<ul>
<li><p><strong>CEV1</strong>: <span class="math inline">\(\mathsf{E}\left(aY_{1}+bY_{2}\left\vert \boldsymbol{X} \right.\right)=a\mathsf{E}\left(Y_{1}\left\vert \boldsymbol{X} \right.\right) +b\mathsf{E}\left(Y_{2}\left\vert \boldsymbol{X} \right.\right)\)</span>, when <span class="math inline">\(a\)</span> are <span class="math inline">\(b\)</span> constants.</p></li>
<li><p><strong>CEV2</strong>: <span class="math inline">\(\mathsf{E}\left(Y\left\vert \boldsymbol{X} \right.  \right)=\mathsf{E}\left(Y\right)\)</span>, when <span class="math inline">\(Y\)</span> and <span class="math inline">\(\boldsymbol{X}\)</span> are independent random variables.</p></li>
<li><p><strong>CEV3</strong>: <span class="math inline">\(\mathsf{E}\left(Y\right)=\mathsf{E}\left[\mathsf{E}\left(Y\left\vert \boldsymbol{X} \right.\right)\right]\)</span> (so-called law of iterated expectations)</p></li>
<li><p><strong>CEV4</strong>: <span class="math inline">\(\mathsf{E}\left[h\left(\boldsymbol{X} \right)Y\left\vert \boldsymbol{X} \right.\right]=h\left(\boldsymbol{X} \right)\mathsf{E}\left(Y\left\vert \boldsymbol{X} \right.\right)\)</span> for any function <span class="math inline">\(h\)</span> (assuming the expected value of <span class="math inline">\(h\left(\boldsymbol{X}\right)Y\)</span> exists and is finite).</p></li>
</ul>
<p>&nbsp;</p>
</section>
<section id="ennusteidenmuodostus" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="ennusteidenmuodostus"><span class="header-section-number">9.2</span> Forming forecasts</h2>
<p><strong>Forecasting an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process</strong>. As the discussion above suggests, we consider forecasting an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process assuming that the entire infinitely long history of the process is known.</p>
<p>In what follows, we again assume that the constant term is included in the model equation to control a nonzero mean of <span class="math inline">\(y_t\)</span> (i.e.&nbsp;<span class="math inline">\(\mathsf{E}(y_t) = \mu \neq 0\)</span>).</p>
<ul>
<li><p>When we are interested in forecasting the levels of <span class="math inline">\(y_t\)</span>, which is often and typically the case, it is important to consider how forecasts will be obtained for original levels if using demeaning of the time series and/or extracting the trend component. That is, all the possible transformations must be carefully taken into account in forecast computations.</p></li>
<li><p>We will also assume that the ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process under consideration is stationary and invertible and that the innovation term satisfies the condition <span class="math inline">\(u_{t}\sim\mathsf{iid}\left(0,\sigma^{2}\right)\)</span>.</p></li>
</ul>
<p>In the calculations that follow, we repeatedly make use of the above-mentioned properties of the conditional expected value (CEV1–CEV4).</p>
<p>&nbsp;</p>
<p><strong>AR(1) case</strong>. Consider forecasting an AR(<span class="math inline">\(p\)</span>) process, and for simplicity, we first also assume that <span class="math inline">\(p=1\)</span>.</p>
<ul>
<li><p>In one-step forecasting, the aim is to forecast the value <span class="math inline">\(y_{t+1}\)</span>, when the preceding history <span class="math inline">\(\left\{y_{t},y_{t-1},\ldots\right\}\)</span> of the process is known.</p></li>
<li><p>More generally, in <span class="math inline">\(h\)</span>-step forecasting, the aim is to forecast the value of <span class="math inline">\(y_{t+h}\)</span>, when <span class="math inline">\(\left\{y_{t},y_{t-1},\ldots\right\}\)</span> is known.</p></li>
</ul>
<p>For brevity, denote the conditional expectation as <span class="math display">\[\begin{equation*}
\mathsf{E}\left(y_{t+h}\left\vert y_{s},\text{ }s\leq t\right.\right) \equiv \mathsf{E}_{t}\left(  y_{t+h}\right), \quad \left(h\geq1\right).
\end{equation*}\]</span> Taking conditional expectations of both sides of the AR(1) equation (forwarded first by one period) <span class="math display">\[\begin{equation*}
    y_{t+1} = \nu + \phi_{1}y_{t}+u_{t+1}
\end{equation*}\]</span> leads to (see CEV1) <span class="math display">\[\begin{equation*}
   \mathsf{E}_{t}\left(y_{t+1}\right) = \nu + \phi_{1}\mathsf{E}_{t}\left(y_{t}\right)+\mathsf{E}_{t}\left(u_{t+1}\right).
\end{equation*}\]</span></p>
<ul>
<li><p>Under the stationarity condition <span class="math inline">\(\left\vert \phi_{1}\right\vert&lt;1\)</span>, the variables <span class="math inline">\(y_{t},y_{t-1},\ldots\)</span> depend only on the variables <span class="math inline">\(u_{t},u_{t-1},\ldots\)</span>. Recall the MA(<span class="math inline">\(\infty\)</span>) representation of <span class="math inline">\(y_t\)</span> to see this.</p></li>
<li><p>Therefore, in the conditional expectation <span class="math inline">\(\mathsf{E}_{t}\left(u_{t+1}\right)\)</span>, the conditioning random variables <span class="math inline">\(\left\{y_{s},s\leq t\right\}\)</span> are independent of <span class="math inline">\(u_{t+1}\)</span>. Following the property CEV2, we then obtain <span class="math display">\[\begin{equation*}
\mathsf{E}_{t}\left(u_{t+1}\right)=\mathsf{E}\left(u_{t+1}\right)=0.
\end{equation*}\]</span> More generally it holds <span class="math display">\[\begin{equation*}
\mathsf{E}_{t}\left(u_{t+k}\right)=\mathsf{E}\left(u_{t+k}\right)=0, \quad k \ge 1.
\end{equation*}\]</span></p></li>
<li><p>Moreover, <span class="math inline">\(\mathsf{E}_{t}\left(y_{t}\right)=y_{t}\)</span> (see CEV4: <span class="math inline">\(y_t\)</span> is included in the information set at time <span class="math inline">\(t\)</span>).</p></li>
</ul>
<p>Putting the above results together, we obtain <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(y_{t+1}\right) = \nu + \phi_{1}y_{t}.
\end{equation*}\]</span></p>
<p>When forecasting <span class="math inline">\(y_{t+2}\)</span>, we obtain <span class="math display">\[\begin{eqnarray*}
    \mathsf{E}_{t}\left(y_{t+2}\right) &amp;=&amp; \nu + \phi_{1}\mathsf{E}_{t}\left(y_{t+1}\right)+\mathsf{E}_{t}\left(u_{t+2}\right) \\
    &amp;=&amp; \nu + \phi_{1}\mathsf{E}_{t}\left(y_{t+1}\right) \\
    &amp;=&amp; (1+\phi_1) \nu + \phi_{1}^{2}y_{t},
\end{eqnarray*}\]</span> and inductively (given <span class="math inline">\(|\phi_1|&lt;1\)</span>), <span class="math inline">\(h\)</span>-period forecast <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(y_{t+h}\right)= (1+\phi_1 + \cdots + \phi^h_1) \nu + \phi_{1}^{h}y_{t} =
    \mu + \phi_{1}^{h}y_{t}.
\end{equation*}\]</span></p>
<p>&nbsp;</p>
<p><strong>AR(<span class="math inline">\(p\)</span>) case</strong>. In the case of a general AR(<span class="math inline">\(p\)</span>) process, we use a similar steps to obtain forecasts. Taking conditional expectations of both sides of <span class="math display">\[\begin{equation*}
    y_{t+1} = \nu + \phi_{1}y_{t}+\cdots+\phi_{p}y_{t+1-p}+u_{t+1},
\end{equation*}\]</span> and using similar arguments as in the case <span class="math inline">\(p=1\)</span>, including the results <span class="math inline">\(\mathsf{E}_{t}\left(u_{t+1}\right)=0\)</span> and <span class="math inline">\(\mathsf{E}_{t}\left(y_{t-j}\right)=y_{t-j}\)</span> <span class="math inline">\(\left(j\geq0\right)\)</span>, we obtain <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(y_{t+1}\right) = \nu + \phi_{1}y_{t}+\cdots+\phi_{p}y_{t+1-p}.
\end{equation*}\]</span> When forecasting <span class="math inline">\(y_{t+2}\)</span>, we similarly obtain <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(y_{t+2}\right)= \nu + \phi_{1}\mathsf{E}_{t}(y_{t+1})+\phi_{2}y_{t}+\cdots+\phi_{p}y_{t+2-p},
\end{equation*}\]</span> where the conditional expected value on the right hand side could be replaced with the expression obtained for it above.</p>
<ul>
<li><p>In other words, the variable <span class="math inline">\(y_{t+1}\)</span>, unknown at time <span class="math inline">\(t\)</span>, has been replaced with its forecast <span class="math inline">\(\mathsf{E}_{t}(y_{t+1})\)</span>.</p></li>
<li><p>The variables <span class="math inline">\(y_{t},\ldots,y_{t+2-p}\)</span> are known at time <span class="math inline">\(t\)</span>. Therefore, they remain on the right hand side as they are included in the information set at the forecast origin.</p></li>
</ul>
<p>Inductively, it is straightforward to see that the above generalizes to forecasting <span class="math inline">\(h\)</span> periods ahead <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(y_{t+h}\right) = \nu + \phi_{1}\mathsf{E}_{t}(y_{t+h-1})+\phi_{2}\mathsf{E}_{t}(y_{t+h-2})+\cdots+\phi_{p}\mathsf{E}_{t}(y_{t+h-p}), \quad h\geq1,
\end{equation*}\]</span> where <span class="math inline">\(\mathsf{E}_{t}\left(y_{t+h-j}\right)=y_{t+h-j}\)</span> for <span class="math inline">\(h\leq j\)</span>. This means that forecasts can be computed recursively, starting with the one-step-ahead case <span class="math inline">\(h=1\)</span>, and proceeding one step at a time to the forecast horizons <span class="math inline">\(h=2\)</span>, <span class="math inline">\(h=3,\ldots\)</span>.</p>
<p>&nbsp;</p>
<p><strong>ARMA(<span class="math inline">\(p,q\)</span>) case</strong>. To obtain forecasting formulae for an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process is quite similar to forecasting with an AR(<span class="math inline">\(p\)</span>) process.</p>
<ul>
<li><p>When the stationarity condition holds, <span class="math inline">\(y_{t}-\mu = \sum_{j=0}^{\infty}\psi_{j}u_{t-j}\)</span>, from which it follows that <span class="math inline">\(u_{t+i}\)</span>, <span class="math inline">\(i\geq1\)</span>, is independent of the variables <span class="math inline">\(\left\{y_{t},y_{t-1},\ldots\right\}\)</span>. Therefore, <span class="math inline">\(\mathsf{E}_{t}(u_{t+i})=\mathsf{E}(u_{t+i})=0\)</span> for all <span class="math inline">\(i\geq0\)</span> (see CEV2).</p></li>
<li><p>On the other hand, when the invertibility condition holds, <span class="math inline">\(u_{t}=\sum_{j=0}^{\infty}\pi_{j}(y_{t-j}-\mu)\)</span>, and therefore <span class="math inline">\(\mathsf{E}_{t}(u_{t-i})=u_{t-i}\)</span> for all <span class="math inline">\(i\geq0\)</span> (see CEV4).</p></li>
</ul>
<p>Taking conditional expectations of both sides of the equation defining an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) and using the above-mentioned properties, we obtain <span class="math inline">\(h\)</span>-period-ahead forecast <span class="math display">\[\begin{eqnarray*}
    \mathsf{E}_{t}(y_{t+h}) &amp;=&amp; \nu +  \phi_{1}\mathsf{E}_{t}(y_{t+h-1})+\cdots+\phi_{p}\mathsf{E}_{t}(y_{t+h-p})
    +  \theta_{1}\mathsf{E}_{t}(u_{t+h-1})+\cdots+\theta_{q}\mathsf{E}_{t}(u_{t+h-q}), \quad h \geq 1,
\end{eqnarray*}\]</span> where <span class="math inline">\(\mathsf{E}_{t}\left(y_{t+h-j}\right)=y_{t+h-j}\)</span> for <span class="math inline">\(h\leq j\)</span>, and <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}\left(u_{t+h-j}\right)=\left\{
    \begin{array}{cc}
         &amp;u _{t+h-j}, \,\, \mathrm{when} \,\, h\leq j, \\
         &amp;0, \,\, \mathrm{when}\,\, h&gt;j.
    \end{array}
    \right.
\end{equation*}\]</span> Using this forecast formula, forecasts can again be computed recursively, starting with the one-step-ahead case <span class="math inline">\(h=1\)</span>, and proceeding one step at a time to the horizons <span class="math inline">\(h=2, h=3,\ldots\)</span>.</p>
<p>&nbsp;</p>
<p>The discussion above makes the unrealistic assumption that the parameters of the examined process are known.</p>
<ul>
<li>In practice, unknown parameters are replaced by their estimates, and in this case the above-mentioned optimality of forecasts (forecast construction) only holds approximately.</li>
</ul>
<p>Moreover, for ARMA models, in practice the innovation terms appearing in the forecasting formulae above (not in the AR(<span class="math inline">\(p\)</span>) case) have to be computed using the observed time series, so in the formula <span class="math inline">\(u_{t}=\sum_{j=0}^{\infty}\pi_{j}(y_{t-j}-\mu)\)</span> we have to truncate the sum at some point (e.g., <span class="math inline">\(\sum_{j=0}^{t-1}\pi_{j} (y_{t-j}-\mu)\)</span>).</p>
<ul>
<li>A popular alternative is to calculate <span class="math inline">\(u_{t}\)</span> using the difference equation <span class="math display">\[\begin{equation*}
  u_{t}=y_{t} - \nu - \phi_{1}y_{t-1}-\cdots-\phi_{p}y_{t-p}-\theta_{1}u_{t-1}-\cdots-\theta_{q}u_{t-q}, \quad t=1,2,\ldots,
\end{equation*}\]</span> where the initial values <span class="math inline">\(y_{0},\ldots,y_{-p}\)</span> can be assumed known (that is, observed), and the initial values <span class="math inline">\(u_{0},\ldots,u_{-q}\)</span> can be chosen to be <span class="math inline">\(u_{0}=\cdots=u_{-q}=0\)</span> (that is, the unconditional mean of the <span class="math inline">\(u_{t}\)</span>). When <span class="math inline">\(t\)</span> is large, the effect of initial values is negligible.</li>
</ul>
<p>&nbsp;</p>
</section>
<section id="prediction-intervals" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="prediction-intervals"><span class="header-section-number">9.3</span> Prediction intervals</h2>
<!-- (confidence interval of a forecast).} -->
<p>An alternative way to approach forecasting an ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) process is via the MA<span class="math inline">\(\left(\infty\right)\)</span> representation. Taking conditional expectations of both sides of the equation <span class="math display">\[\begin{equation*}
    y_{t+h}= \mu + \sum_{j=0}^{\infty}\psi_{j}u_{t+h-j},
\end{equation*}\]</span> and using results of conditional expectations used above, we obtain <span class="math display">\[\begin{equation*}
    \mathsf{E}_{t}(y_{t+h}) = \mu + \sum_{j=h}^{\infty}\psi_{j}u_{t+h-j}.
\end{equation*}\]</span> This formula is not useful in practice, but it is convenient for investigating the properties of the forecast error <span class="math inline">\(y_{t+h}-\mathsf{E}_{t}(y_{t+h})\)</span>. From the two equations above, we obtain <span class="math display">\[\begin{equation*}
    y_{t+h}-\mathsf{E}_{t}(y_{t+h})=\sum_{j=0}^{h-1}\psi_{j}u_{t+h-j}.
\end{equation*}\]</span> Note, in particular, that the forecast error of the one-step forecast is <span class="math inline">\(u_{t+1}\)</span>.</p>
<ul>
<li><p>Taking (unconditional) expectations from both sides of the last equation shows that the forecast <span class="math inline">\(\mathsf{E}_{t}(y_{t+h})\)</span> is unbiased in the sense that the forecast error has an expected value of zero: <span class="math display">\[\begin{equation*}
\mathsf{E}\left[y_{t+h}-\mathsf{E}_{t}(y_{t+h})\right]=0.
\end{equation*}\]</span></p></li>
<li><p>Furthermore, we can compute the variance of the forecast error. With straightforward computation, we obtain <span class="math display">\[\begin{equation*}
  \mathsf{Var}\Big(y_{t+h}-\mathsf{E}_{t}(y_{t+h})\Big)=\sigma^{2}\sum_{j=0}^{h-1}\psi_{j}^{2}\equiv\sigma_{h}^{2}.
\end{equation*}\]</span></p></li>
<li><p>Importantly, note that as <span class="math inline">\(h\)</span> increases, the forecast converges (in mean square) to the mean of the process, whereas the variance of the forecast error <span class="math inline">\(\sigma_{h}^{2}\)</span> converges to the variance of the process being predicted (<span class="math inline">\(y_{t}\)</span>), namely <span class="math inline">\(\sigma^{2}\sum_{j=0}^{\infty}\psi_{j}^{2}\)</span> (cf.&nbsp;the properties of the ARMA process).</p></li>
</ul>
<p>&nbsp;</p>
<p>If one assumes that <span class="math inline">\(u_{t}\sim\mathsf{nid}\left(0,\sigma^{2}\right)\)</span>, then <span class="math display">\[\begin{equation*}
    y_{t+h}-\mathsf{E}_{t}(y_{t+h})\sim\mathsf{N}\left(0,\sigma_{h}^{2}\right)
\end{equation*}\]</span> and, therefore, <span class="math inline">\(y_{t+h}\)</span> is contained in the interval <span class="math display">\[\begin{equation*}
\mathsf{E}_{t}(y_{t+h})\pm1.96\sigma_{h}
\end{equation*}\]</span> with 95% probability (in repeated sampling). In practice, the unknown parameters in the forecast <span class="math inline">\(\mathsf{E}_{t}(y_{t+h})\)</span> and in the standard deviation <span class="math inline">\(\sigma_{h}\)</span> are replaced by their estimates, and hence the normality of the forecast errors hold only approximately.</p>
<p>&nbsp;</p>
<p><strong>Empirical example (continue)</strong>. In the previous two sections, we concluded that an AR(2) model to be one possible candidate for the U.S real GDP growth (1985:Q1–2007:Q2). The estimated AR(2) model <span class="math display">\[\begin{equation*}
    y_{t} = \underset{\left(0.197\right) }{1.693} + \underset{\left(0.101\right) }{0.160} y_{t-1} + \underset{\left(0.101\right) }{0.287} y_{t-1} + \widehat{u}_{t}, \quad \widehat{\sigma}^{2}=3.536,
\end{equation*}\]</span> is now used to compute 8-quarter-ahead predictions. Starting from the last observation (2007:Q2), forecasts are obtained with the forecasting formulae above applied in the case of <span class="math inline">\(p=2\)</span> (and <span class="math inline">\(q=0\)</span>) and <span class="math inline">\(h=8\)</span>. The resulting (point) forecasts of the estimated AR(2) model and their 80 and 95% confidence intervals are presented below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="in">        Point Forecast      Lo 80    Hi 80      Lo 95    Hi 95</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>2007 Q3       2.427727 0.01787587 4.837578 -1.2578223 6.113277</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>2007 Q4       2.781453 0.34098863 5.221917 -0.9509150 6.513820</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>2008 Q1       2.834604 0.28036903 5.388840 -1.0717615 6.740971</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>2008 Q2       2.944709 0.38002888 5.509388 -0.9776305 6.867048</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>2008 Q3       2.977582 0.40040373 5.554759 -0.9638718 6.919035</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>2008 Q4       3.014464 0.43506842 5.593860 -0.9303814 6.959310</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>2009 Q1       3.029805 0.44884169 5.610767 -0.9174375 6.977047</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>2009 Q2       3.042852 0.46149492 5.624209 -0.9049929 6.990696</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The figure below depicts the 8-step forecasts and the confidence intervals. As we can see, the forecast converges towards the mean (3.10) when the forecast horizon lengthens. The confidence intervals are quite broad.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Forecasts-AR2-usrealgdp.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:65.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<span style="color: #0069d9;">Figure: 8-step-ahead forecasts for the U.S. real GDP growth and their 80 and 95% confidence intervals from the AR(2) process.</span>
</center>
<p>&nbsp;</p>
<p>Obviously these forecasts, constructed at 2007:Q2, for the years 2008 and 2009 turned out to be too optimistic due to the Great Financial Crisis (2008–2009) and possible endpoint of the Great Moderation! It can generally be concluded that there were no econometric model able to predict such a depression. Therefore, these presented forecasts should be seen as a scenario type of forecasts how the U.S. economy could have been evolved without the financial crisis.</p>
<p>&nbsp;</p>
</section>
<section id="introduction-to-out-of-sample-forecasting" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="introduction-to-out-of-sample-forecasting"><span class="header-section-number">9.4</span> Introduction to out-of-sample forecasting</h2>
<p>In various fields, particularly in economics and finance, it is crucial to assess the reliability and accuracy of forecasts generated by estimated time series models. A popular method for this evaluation is (pseudo) <strong>out-of-sample forecasting</strong>. This approach aims to mimic a real-time forecasting scenario as closely as possible, using only information that would have been available at the time the forecast was made.</p>
<p>The fundamental idea is to evaluate the forecast performance by systematically reserving a portion of the data, unknown to the model during its estimation, to serve as a “future” against which forecasts are compared. This method is termed at times “pseudo” out-of-sample forecasting because, while we are simulating real-time forecasting, we do have full knowledge of the entire dataset beforehand in our analysis. In a “true” real-time forecasting, future observations are, by definition, unknown.</p>
<ul>
<li>Notice that <strong>backtesting</strong> in the financial industry is essentially a form of out-of-sample forecasting applied specifically to financial data and trading strategies. While the underlying principle is the same, the terminology and focus can differ slightly. While a time series analyst might use out-of-sample forecasting to evaluate how accurately they can predict a stock’s price, a financial analyst would use backtesting to see if a strategy based on those predictions would have actually made money.</li>
</ul>
<p>&nbsp;</p>
<p><strong>The out-of-sample forecasting process</strong> generally involves the following steps:</p>
<ol type="1">
<li><p><strong>Define initial estimation sample</strong>: An initial segment of the time series, say the first <span class="math inline">\(T\)</span> observations (<span class="math inline">\(y_1, \dots, y_T\)</span>), is used to estimate the model’s parameters. This period is often referred to as the <strong>training sample</strong> or <strong>estimation sample</strong>.</p></li>
<li><p><strong>Define forecasting horizon (<span class="math inline">\(h\)</span>)</strong>: Like above where we introduced how to construct forecasts with ARMA models, we specify how many periods ahead we want to forecast (e.g., <span class="math inline">\(h=1\)</span> for one-period-ahead, <span class="math inline">\(h=2\)</span> for two-periods-ahead, etc.).</p></li>
<li><p><strong>Define forecasting evaluation period</strong>: A subsequent segment of the data, known as the <strong>test sample</strong> or <strong>forecasting sample</strong>, is set aside. This period spans from <span class="math inline">\(y_{T+1}\)</span> up to <span class="math inline">\(y_{T+m+h-1}\)</span>, where <span class="math inline">\(m\)</span> is the number of distinct <strong>forecast origins</strong> (i.e., the number of times we re-estimate the model and generate a new <span class="math inline">\(h\)</span>-step forecast). In other words, with this notation, we assume that we have observations <span class="math inline">\(y_1,\ldots,y_T, y_{T+1},\ldots, y_{T+m+h^{\mathrm{max}}-1}\)</span> where <span class="math inline">\(h^{\mathrm{max}}\)</span> is the maximum or the considered forecast horizon.</p></li>
<li><p><strong>Iterative forecasting and parameter updating</strong>: The core of (pseudo) out-of-sample forecasting is its iterative nature. We start by estimating the model using the initial <span class="math inline">\(T\)</span> observations, then we construct forecasts <span class="math inline">\(h\)</span> periods ahead. We then “advance time” by one period, potentially re-estimate the model with updated information, and generate a new <span class="math inline">\(h\)</span>-period-ahead forecast. This process is repeated <span class="math inline">\(m\)</span> times.</p></li>
</ol>
<p>&nbsp;</p>
<p>Let’s clarify the notation with an example. Suppose we want to evaluate two-period-ahead forecasts (<span class="math inline">\(h=2\)</span>).</p>
<ul>
<li><p>Let <span class="math inline">\(T\)</span> denote the end of our <em>initial</em> estimation sample.</p></li>
<li><p>Let <span class="math inline">\(j\)</span> be an index for the forecast origin, running from <span class="math inline">\(j=0, 1, \dots, m-1\)</span>. For simplicity, let <span class="math inline">\(m=4\)</span>.</p></li>
</ul>
<p>The sequence of forecasts at different forecast origins and their corresponding actual values would be:</p>
<ul>
<li>Forecast origin <span class="math inline">\(T\)</span> (i.e., <span class="math inline">\(j=0\)</span>):
<ul>
<li>Estimate the model using data <span class="math inline">\(y_1, \dots, y_T\)</span>.</li>
<li>Generate a <span class="math inline">\(h=2\)</span> period forecast, denoted <span class="math inline">\(\widehat{y}_{T+2|T}\)</span>.</li>
<li>This forecast is compared against the actual observation <span class="math inline">\(y_{T+2}\)</span>.</li>
<li>The forecast error is <span class="math inline">\(\widehat{e}_{T+2} = y_{T+2} - \widehat{y}_{T+2|T}\)</span>.</li>
</ul></li>
<li>Forecast origin <span class="math inline">\(T+1\)</span> (i.e., <span class="math inline">\(j=1\)</span>):
<ul>
<li>Update the estimation sample. This is where rolling vs.&nbsp;expanding parameter updating window (see below) becomes relevant.</li>
<li>Generate a <span class="math inline">\(h=2\)</span>-period forecast, denoted <span class="math inline">\(\widehat{y}_{T+3|T+1}\)</span>.</li>
<li>This forecast is compared against the actual observation <span class="math inline">\(y_{T+3}\)</span>.</li>
<li>The forecast error is <span class="math inline">\(\widehat{e}_{T+3} = y_{T+3} - \widehat{y}_{T+3|T+1}\)</span>.</li>
</ul></li>
<li>Forecast origin <span class="math inline">\(T+2\)</span> (i.e., <span class="math inline">\(j=2\)</span>):
<ul>
<li>Update the estimation sample.</li>
<li>Generate a <span class="math inline">\(h=2\)</span>-period forecast, denoted <span class="math inline">\(\widehat{y}_{T+4|T+2}\)</span>.</li>
<li>This forecast is compared against the actual observation <span class="math inline">\(y_{T+4}\)</span>.</li>
<li>The forecast error is <span class="math inline">\(\widehat{e}_{T+4} = y_{T+4} - \widehat{y}_{T+4|T+2}\)</span>.</li>
</ul></li>
<li>Forecast origin <span class="math inline">\(T+3\)</span> (i.e., <span class="math inline">\(j=3\)</span>):
<ul>
<li>Update the estimation sample.</li>
<li>Generate a <span class="math inline">\(h=2\)</span>-period forecast, denoted <span class="math inline">\(\widehat{y}_{T+5|T+3}\)</span>.</li>
<li>This forecast is compared against the actual observation <span class="math inline">\(y_{T+5}\)</span>.</li>
<li>The forecast error is <span class="math inline">\(\widehat{e}_{T+5} = y_{T+5} - \widehat{y}_{T+5|T+3}\)</span>.</li>
</ul></li>
</ul>
<p>In general, for <span class="math inline">\(j=0, 1, \dots, m-1\)</span>, we compute the <span class="math inline">\(h\)</span>-period forecast from the information available at <span class="math inline">\(T+j\)</span>, denoted <span class="math inline">\(\widehat{y}_{T+h+j|T+j}\)</span>. The corresponding forecast error is: <span class="math display">\[\begin{equation*}
\widehat{e}_{T+h+j} = y_{T+h+j} - \widehat{y}_{T+h+j|T+j}
\end{equation*}\]</span></p>
<p>&nbsp;</p>
<p><strong>Parameter updating strategies</strong>. In a real forecasting situation, the information set used for model estimation typically includes the most recent observations. The way this information set is updated over time defines different parameter estimation strategies:</p>
<ul>
<li><p><strong>Expanding window</strong>: In this approach, the estimation sample grows by one observation in each forecast computation iteration. If the initial estimation sample is <span class="math inline">\(y_1, \dots, y_T\)</span>, the next estimation sample will be <span class="math inline">\(y_1, \dots, y_{T+1}\)</span>, then <span class="math inline">\(y_1, \dots, y_{T+2}\)</span>, and so on. This means older observations are always retained. This is suitable when one believes that all past data is equally relevant for estimating the current parameters.</p></li>
<li><p><strong>Rolling window</strong>: Here, the estimation sample has a fixed size (e.g., <span class="math inline">\(T\)</span> observations) and “rolls” forward by one observation in each iteration. If the initial sample is <span class="math inline">\(y_1, \dots, y_T\)</span>, the next sample will be <span class="math inline">\(y_2, \dots, y_{T+1}\)</span>, then <span class="math inline">\(y_3, \dots, y_{T+2}\)</span>, and so on. This approach gives more weight to recent observations and is useful when model parameters are suspected to change over time (i.e., the presence of structural breaks or regime changes).</p></li>
</ul>
<p>The accompanying R code (R Lab below) allows you to select either a <code>rolling</code> or <code>expanding</code> window strategy using the <code>window_type</code> parameter.</p>
<p>&nbsp;</p>
<p><strong>Evaluating forecast accuracy</strong>. Once the forecast errors (<span class="math inline">\(\widehat{e}_{T+h+j}\)</span>) for the entire test sample are computed, a typical measure for evaluating forecast accuracy is the <strong>Mean Squared Forecast Error (MSFE)</strong>: <span class="math display">\[\begin{equation*}
MSFE = \frac{1}{m} \sum_{j=0}^{m-1} \widehat{e}_{T+h+j}^2.
\end{equation*}\]</span> The MSFE penalizes larger errors more heavily due to the squaring forecast errors. Its square root, the <strong>Root Mean Squared Forecast Error (RMSFE)</strong>, is also commonly used as it is in the same units as the original series, making it easier to interpret.</p>
<p>Another popular alternative is the <strong>Mean Absolute Forecast Error (MAFE)</strong>: <span class="math display">\[\begin{equation*}
MAFE = \frac{1}{m} \sum_{j=0}^{m-1} |\widehat{e}_{T+h+j}|.
\end{equation*}\]</span> The MAFE is less sensitive to outliers than the MSFE.</p>
<p>The objective of this exercise is to identify the model(s) that produce the smallest MSFE and/or MAFE values, indicating superior forecasting performance.</p>
<p>&nbsp;</p>
<p><strong>Empirical example (continue)</strong>. Let us continue an illustration of out-of-sample forecasting of the quarterly U.S. real GDP growth. Assume that we start out-of-sample forecasting in 2010:Q1 and construct one (<span class="math inline">\(h=1\)</span>) and four (<span class="math inline">\(h=4\)</span>) quarter out-of-sample forecasts for the forecasting sample (test) sample period 2010:Q1–2019:Q4. We compare the performance of AR(1), AR(2), AR(3) and AR(4) models.</p>
<ul>
<li><p>The first estimation sample is between 1985:Q1–2009:Q4.</p></li>
<li><p>Obviously, based on the previous results (for the sample period excluding the Great Financial Crisis) suggest the AR(2) model.</p></li>
<li><p>Parameter updating is done via expanding and rolling window approaches separately.</p></li>
<li><p>MSFEs suggest that except <span class="math inline">\(h=4\)</span> horizon and rolling window approach (there AR(4) model), AR(3) model yields the smallest MSFE in different comparisons.</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, expanding window) ---</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(1)`</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 3.010018</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(2)`</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.810865</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(3)`</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.760154</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(4)`</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 3.451758</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, rolling window) ---</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(1)`</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 3.032567</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(2)`</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.793521</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(3)`</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.731007</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(4)`</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 3.481733</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, expanding window) ---</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(1)`</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.628715</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(2)`</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.662022</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(3)`</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.457973</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(4)`</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.467844</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, rolling window) ---</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(1)`</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.602836</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(2)`</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.633853</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(3)`</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.496958</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>$<span class="in">`AR(4)`</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">]</span> 2.478106</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
</section>
<section id="r-lab" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="r-lab"><span class="header-section-number">9.5</span> R Lab</h2>
<p>All the R codes considered in this section are compiled in the following links.</p>
<button class="toggle-button toggle-button-r" onclick="toggleCode('r-code9')">
R Lab: Forecast computation in ARMA models
</button>
<div id="r-code9" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  FORECASTING</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ARMA MODELLING</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># U.S. GDP GROWTH ANALYSIS: DETAILED SELECTION &amp; EXTENDED DIAGNOSTICS</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Final version with restored comparative model selection (AR vs. ARMA)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># and a dedicated step for the user to choose the final model.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  LOAD LIBRARIES</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>packages_to_load <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tseries"</span>, <span class="st">"forecast"</span>, <span class="st">"ggplot2"</span>, <span class="st">"readxl"</span>, <span class="st">"dplyr"</span>, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"lubridate"</span>, <span class="st">"astsa"</span>, <span class="st">"TSA"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> packages_to_load) {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#install.packages(pkg) # uncomment this</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  DATA ACQUISITION AND PREPARATION</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="st">"1984-10-01"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>end_date   <span class="ot">&lt;-</span> <span class="st">"2007-04-01"</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"GDPC1-qdata.xlsx"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> Date, <span class="at">value =</span> GDPC1) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(start_date) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(end_date))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>gdp_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(raw_data<span class="sc">$</span>value, </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">year</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>]), <span class="fu">quarter</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>])), </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(gdp_ts)) <span class="sc">*</span> <span class="dv">400</span>  <span class="co"># Annualized growth rate</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(gdp_growth)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">#  VISUALIZATION AND MANUAL IDENTIFICATION</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gdp_growth) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"(Annualized) U.S. quarterly real GDP growth rate (1985:Q1-2007:Q2)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(gdp_growth, <span class="at">main=</span><span class="st">"ACF of GDP Growth"</span>)  <span class="co"># forecast package</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(gdp_growth, <span class="at">main=</span><span class="st">"PACF of GDP Growth"</span>) <span class="co"># forecast package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Extended Ljung-Box Test ---</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended Ljung-Box Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended Ljung-Box Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lags_to_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lb_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Lag=</span><span class="fu">integer</span>(), <span class="st">"Q-statistic"</span><span class="ot">=</span><span class="fu">double</span>(), <span class="st">"p-value"</span><span class="ot">=</span><span class="fu">double</span>())</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(gdp_growth, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, <span class="at">lag =</span> l, <span class="at">fitdf =</span> <span class="dv">0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  lb_results[<span class="fu">nrow</span>(lb_results) <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(test<span class="sc">$</span>statistic, <span class="dv">3</span>), <span class="fu">round</span>(test<span class="sc">$</span>p.value, <span class="dv">3</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lb_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag Q.statistic p.value
1   4      16.487   0.002
2   8      19.494   0.012
3  12      27.942   0.006
4  16      32.897   0.008
5  20      34.679   0.022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- McLeod-Li Test ---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended McLeod-Li Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended McLeod-Li Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ml_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lag =</span> <span class="fu">integer</span>(),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_value =</span> <span class="fu">numeric</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> TSA<span class="sc">::</span><span class="fu">McLeod.Li.test</span>(<span class="at">y =</span> gdp_growth, <span class="at">gof.lag =</span> l)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> test<span class="sc">$</span>p.values[l] <span class="co"># Extract p-value for the current lag</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ml_results[<span class="fu">nrow</span>(ml_results) <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(pval, <span class="dv">3</span>)) <span class="co"># Append row: lag and p-value</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml_results) <span class="co"># This package does not print out the values of the test </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag p_value
1   4   0.342
2   8   0.564
3  12   0.533
4  16   0.688
5  20   0.717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistic (only p-values)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  DETAILED MODEL SELECTION (using Conditional MLE)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Running Detailed Model Selection ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Running Detailed Model Selection ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- (i) - Restricting to AR Models Only ---</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- SCENARIO 1: AR-ONLY MODELS ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- SCENARIO 1: AR-ONLY MODELS ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ar_aic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">max.q =</span><span class="dv">0</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"aic"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best AR model selected by AIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best AR model selected by AIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ar_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(3,0,0) with non-zero mean 

Coefficients:
         ar1     ar2      ar3    mean
      0.1855  0.2976  -0.0966  3.0185
s.e.  0.1037  0.1012   0.1042  0.3184

sigma^2 = 3.458:  log likelihood = -183.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ar_bic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">max.q =</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"bic"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best AR model selected by BIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best AR model selected by BIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ar_bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(2,0,0) with non-zero mean 

Coefficients:
         ar1     ar2    mean
      0.1599  0.2872  3.0614
s.e.  0.1010  0.1015  0.3567

sigma^2 = 3.536:  log likelihood = -184.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- (ii) - Allowing ARMA Models ---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- SCENARIO 2: ARMA MODELS ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- SCENARIO 2: ARMA MODELS ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>arma_aic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"aic"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best ARMA model selected by AIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best ARMA model selected by AIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arma_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(0,0,2) with non-zero mean 

Coefficients:
         ma1     ma2    mean
      0.2047  0.2998  3.0893
s.e.  0.1031  0.0964  0.2919

sigma^2 = 3.556:  log likelihood = -183.27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>arma_bic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"bic"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best ARMA model selected by BIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best ARMA model selected by BIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arma_bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(0,0,0) with non-zero mean 

Coefficients:
        mean
      3.1001
s.e.  0.2089

sigma^2 = 3.97:  log likelihood = -189.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  CHOOSE YOUR FINAL MODEL</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># After reviewing the 4 models above, assign your choice to 'final_model'.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The default is the AR model selected by AIC.</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Selecting Final Model for Detailed Analysis ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Selecting Final Model for Detailed Analysis ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#final_model &lt;- ar_aic   # &lt;--- SET YOUR CHOICE HERE</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>final_model <span class="ot">&lt;-</span> ar_bic</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># final_model &lt;- arma_aic</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># final_model &lt;- arma_bic  </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing forecasts. Forecast origin is the last observation of time series</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that this part requires the running of ARMA modelling code above in </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Sections 5-7 (i.e. "final model" contain estimation result for gdp growth).</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Forecasting from Final Model ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Forecasting from Final Model ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>gdp_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(final_model, <span class="at">h=</span><span class="dv">8</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>gdp_forecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Point Forecast      Lo 80    Hi 80      Lo 95    Hi 95
2007 Q3       2.427727 0.01787587 4.837578 -1.2578223 6.113277
2007 Q4       2.781453 0.34098863 5.221917 -0.9509150 6.513820
2008 Q1       2.834604 0.28036903 5.388840 -1.0717615 6.740971
2008 Q2       2.944709 0.38002888 5.509388 -0.9776305 6.867048
2008 Q3       2.977582 0.40040373 5.554759 -0.9638718 6.919035
2008 Q4       3.014464 0.43506842 5.593860 -0.9303814 6.959310
2009 Q1       3.029805 0.44884169 5.610767 -0.9174375 6.977047
2009 Q2       3.042852 0.46149492 5.624209 -0.9049929 6.990696</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gdp_forecast) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Forecast from Final Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-1-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<button class="toggle-button toggle-button-r" onclick="toggleCode('r-code10')">
R Lab: Out-of-sample forecasting
</button>
<div id="r-code10" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OOS FORECASTING (with AR models)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># See OUT-OF-SAMPLE FORECASTING FOR GDP GROWTH at the end after developing</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_forecast function</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># LOAD LIBRARIES</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>packages_to_load <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tseries"</span>, <span class="st">"forecast"</span>, <span class="st">"ggplot2"</span>, <span class="st">"readxl"</span>, <span class="st">"dplyr"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"lubridate"</span>, <span class="st">"astsa"</span>, <span class="st">"TSA"</span>, <span class="st">"writexl"</span>) </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> packages_to_load) {</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#install.packages(pkg) # uncomment this</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co"># DATA ACQUISITION AND PREPARATION</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co"># This section defines the *full range* of data available for your analysis.</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># The 'start_date' and 'end_date' here constrain the raw data loaded from the Excel file.</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># The out-of-sample forecasting will operate *within* this prepared 'gdp_growth' series.</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="st">"1984-10-01"</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>end_date   <span class="ot">&lt;-</span> <span class="st">"2018-10-01"</span> <span class="co"># This is your desired end date for the *filtered* data</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- IMPORTANT: Ensure 'GDPC1-qdata.xlsx' exists in your working directory ---</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- and contains data up to or beyond the 'end_date' specified above. ---</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"GDPC1-qdata.xlsx"</span>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> Date, <span class="at">value =</span> GDPC1) <span class="sc">%&gt;%</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(start_date) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(end_date)) <span class="co"># This filter now correctly uses your end_date</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>gdp_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(raw_data<span class="sc">$</span>value,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">year</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>]), <span class="fu">quarter</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>])),</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(gdp_ts)) <span class="sc">*</span> <span class="dv">400</span>  <span class="co"># Annualized growth rate</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(gdp_growth) <span class="co"># Remove NA from differencing</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a glimpse of the prepared gdp_growth series</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- GDP Growth Series Prepared ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- GDP Growth Series Prepared ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(gdp_growth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Qtr1     Qtr2     Qtr3     Qtr4
1985 3.857259 3.506480 6.062904 2.962797
1986 3.717661 1.797142                  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tail</span>(gdp_growth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Qtr1     Qtr2     Qtr3     Qtr4
2017                   3.141726 4.482971
2018 3.240478 2.117685 2.487042 0.566176</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Full length of gdp_growth series available for forecasting:"</span>, <span class="fu">length</span>(gdp_growth), <span class="st">"observations.</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Full length of gdp_growth series available for forecasting: 136 observations.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Time attributes:"</span>, <span class="fu">paste</span>(<span class="fu">start</span>(gdp_growth), <span class="at">collapse=</span><span class="st">"-"</span>), <span class="st">"to"</span>, <span class="fu">paste</span>(<span class="fu">end</span>(gdp_growth), <span class="at">collapse=</span><span class="st">"-"</span>), <span class="st">"at frequency"</span>, <span class="fu">frequency</span>(gdp_growth), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time attributes: 1985-1 to 2018-4 at frequency 4 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- MODIFIED AR_FORECAST FUNCTION ---</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Allows selection of initial estimation sample period by its end index or date.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ar_forecast <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    data,                <span class="co"># Your time series data (numeric vector or ts object)</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    p_values,            <span class="co"># Vector of p values to compare (e.g., c(1, 2, 3))</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_end_index =</span> <span class="cn">NULL</span>, <span class="co"># End index of the initial training sample</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_end_date =</span> <span class="cn">NULL</span>,  <span class="co"># End date of the initial training sample (if data is ts)</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_train_obs =</span> <span class="cn">NULL</span>,   <span class="co"># Minimum number of observations in training sample (now a soft check)</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">window_type =</span> <span class="fu">c</span>(<span class="st">"rolling"</span>, <span class="st">"expanding"</span>), <span class="co"># Window type for parameter updating</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">forecast_horizon =</span> <span class="dv">1</span>, <span class="co"># Forecast horizon h (number of periods ahead to forecast)</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_results =</span> <span class="cn">TRUE</span>  <span class="co"># Whether to plot the results</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Input validation</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(data) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">inherits</span>(data, <span class="st">"ts"</span>)) <span class="fu">stop</span>(<span class="st">"data must be a numeric vector or a ts object."</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(p_values) <span class="sc">||</span> <span class="fu">any</span>(p_values <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">||</span> <span class="fu">any</span>(p_values <span class="sc">!=</span> <span class="fu">round</span>(p_values))) <span class="fu">stop</span>(<span class="st">"p_values must be positive integers."</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(train_end_index) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(train_end_date)) {</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Either train_end_index or train_end_date must be provided to define the initial training sample."</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(train_end_index) <span class="sc">&amp;&amp;</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(train_end_index) <span class="sc">||</span> train_end_index <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">||</span> train_end_index <span class="sc">!=</span> <span class="fu">round</span>(train_end_index))) <span class="fu">stop</span>(<span class="st">"train_end_index must be a positive integer."</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(min_train_obs) <span class="sc">&amp;&amp;</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(min_train_obs) <span class="sc">||</span> min_train_obs <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">||</span> min_train_obs <span class="sc">!=</span> <span class="fu">round</span>(min_train_obs))) <span class="fu">stop</span>(<span class="st">"min_train_obs must be a positive integer."</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>  window_type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(window_type)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(forecast_horizon) <span class="sc">||</span> forecast_horizon <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">||</span> forecast_horizon <span class="sc">!=</span> <span class="fu">round</span>(forecast_horizon)) <span class="fu">stop</span>(<span class="st">"forecast_horizon must be a positive integer."</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine initial training sample size based on index or date</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  initial_train_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(train_end_date)) {</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(data, <span class="st">"ts"</span>)) <span class="fu">stop</span>(<span class="st">"train_end_date can only be used with a 'ts' object."</span>)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the character date to a 'Date' object first</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>    target_date_obj <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(train_end_date)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract year and appropriate sub-period</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>    target_year <span class="ot">&lt;-</span> <span class="fu">year</span>(target_date_obj)</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>    target_freq <span class="ot">&lt;-</span> <span class="fu">frequency</span>(data)</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>    target_sub_period <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (target_freq <span class="sc">==</span> <span class="dv">4</span>) { <span class="co"># Quarterly data</span></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>      target_sub_period <span class="ot">&lt;-</span> <span class="fu">quarter</span>(target_date_obj)</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (target_freq <span class="sc">==</span> <span class="dv">12</span>) { <span class="co"># Monthly data</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>      target_sub_period <span class="ot">&lt;-</span> <span class="fu">month</span>(target_date_obj)</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (target_freq <span class="sc">==</span> <span class="dv">1</span>) { <span class="co"># Yearly data</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>      target_sub_period <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Not relevant, but keeps structure</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Unsupported frequency for train_end_date. Only 1 (yearly), 4 (quarterly), 12 (monthly) are directly supported."</span>)</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a time series index value from the target date</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>    target_time_value <span class="ot">&lt;-</span> target_year</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (target_freq <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>      target_time_value <span class="ot">&lt;-</span> target_time_value <span class="sc">+</span> (target_sub_period <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> target_freq</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index in the time series data that matches or is closest to target_time_value</span></span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use which.min(abs(...)) to find the closest time point if an exact match isn't present</span></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>    initial_train_size <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">time</span>(data) <span class="sc">-</span> target_time_value))</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the found index's time value is truly before or at the target</span></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">time</span>(data)[initial_train_size] <span class="sc">&gt;</span> target_time_value <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>(target_freq<span class="sc">*</span><span class="dv">2</span>)) <span class="sc">&amp;&amp;</span> <span class="fu">time</span>(data)[initial_train_size] <span class="sc">&gt;</span> target_time_value) { <span class="co"># Add a small tolerance</span></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"train_end_date ("</span>, train_end_date, <span class="st">") resulted in an index where the time point ("</span>, <span class="fu">time</span>(data)[initial_train_size], <span class="st">") is *after* the target date. Please ensure the date is within the series range or select a valid end date."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure that the found index isn't past the end of the series</span></span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (initial_train_size <span class="sc">&gt;</span> n) {</span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"train_end_date ("</span>, train_end_date, <span class="st">") is after the end of the provided data series."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># Use train_end_index</span></span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a>    initial_train_size <span class="ot">&lt;-</span> train_end_index</span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final check on initial_train_size</span></span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(initial_train_size) <span class="sc">||</span> initial_train_size <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">||</span> initial_train_size <span class="sc">&gt;</span> n) {</span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Calculated initial training sample size is invalid or out of bounds for the data series."</span>)</span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply min_train_obs if provided, primarily as a check or warning</span></span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(min_train_obs) <span class="sc">&amp;&amp;</span> initial_train_size <span class="sc">&lt;</span> min_train_obs) {</span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Specified train_end_index/date results in an initial training sample ("</span>, initial_train_size, <span class="st">") smaller than min_train_obs ("</span>, min_train_obs, <span class="st">"). Proceeding with the smaller size."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (initial_train_size <span class="sc">&lt;</span> <span class="fu">max</span>(p_values) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Initial training sample size ("</span>, initial_train_size, <span class="st">") is too small to fit an AR model for the largest p value ("</span>, <span class="fu">max</span>(p_values), <span class="st">"). Increase train_end_index/date."</span>)</span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (initial_train_size <span class="sc">+</span> forecast_horizon <span class="sc">&gt;</span> n) {</span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The initial training sample period is too long ("</span>, <span class="fu">time</span>(data)[initial_train_size], <span class="st">") given the forecast horizon ("</span>, forecast_horizon, <span class="st">") and total data length ("</span>, <span class="fu">time</span>(data)[n], <span class="st">"). Not enough data left for testing."</span>)</span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Initial Sample Selection ---</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Initial training (estimation) sample ends at index: "</span>, initial_train_size, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Corresponding time point: "</span>, <span class="fu">time</span>(data)[initial_train_size], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Out-of-sample forecasting (test) period starts at index: "</span>, initial_train_size <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Corresponding time point: "</span>, <span class="fu">time</span>(data)[initial_train_size <span class="sc">+</span> <span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize lists to store forecasts and errors</span></span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true" tabindex="-1"></a>  all_forecasts <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># This will store the forecast series</span></span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true" tabindex="-1"></a>  all_msfe <span class="ot">&lt;-</span> <span class="fu">list</span>()      <span class="co"># This will store only the MSFE values</span></span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p_values) {</span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Forecasting for AR("</span>, p, <span class="st">") ---</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The length of the 'forecasts' vector corresponds to the number of forecast origins</span></span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true" tabindex="-1"></a>    num_forecast_origins <span class="ot">&lt;-</span> n <span class="sc">-</span> initial_train_size <span class="sc">-</span> forecast_horizon <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (num_forecast_origins <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">"Not enough data to make any forecasts for AR("</span>, p, <span class="st">") with current settings. Skipping."</span>))</span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true" tabindex="-1"></a>      all_msfe[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")"</span>)]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-110"><a href="#cb53-110" aria-hidden="true" tabindex="-1"></a>      all_forecasts[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")_series"</span>)]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-111"><a href="#cb53-111" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb53-112"><a href="#cb53-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-113"><a href="#cb53-113" aria-hidden="true" tabindex="-1"></a>    forecasts_for_p <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_forecast_origins)</span>
<span id="cb53-114"><a href="#cb53-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-115"><a href="#cb53-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-116"><a href="#cb53-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through the test set (i.e., each forecast origin)</span></span>
<span id="cb53-117"><a href="#cb53-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(num_forecast_origins <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb53-118"><a href="#cb53-118" aria-hidden="true" tabindex="-1"></a>      current_train_end_idx <span class="ot">&lt;-</span> initial_train_size <span class="sc">+</span> i</span>
<span id="cb53-119"><a href="#cb53-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-120"><a href="#cb53-120" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (window_type <span class="sc">==</span> <span class="st">"rolling"</span>) {</span>
<span id="cb53-121"><a href="#cb53-121" aria-hidden="true" tabindex="-1"></a>        start_roll_idx <span class="ot">&lt;-</span> current_train_end_idx <span class="sc">-</span> initial_train_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb53-122"><a href="#cb53-122" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The rolling window should always be `initial_train_size` long.</span></span>
<span id="cb53-123"><a href="#cb53-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If current_train_end_idx == initial_train_size (first iter), start_roll_idx == 1.</span></span>
<span id="cb53-124"><a href="#cb53-124" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If current_train_end_idx == initial_train_size + 1, start_roll_idx == 2.</span></span>
<span id="cb53-125"><a href="#cb53-125" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This ensures the window size is constant.</span></span>
<span id="cb53-126"><a href="#cb53-126" aria-hidden="true" tabindex="-1"></a>        train_data <span class="ot">&lt;-</span> data[start_roll_idx<span class="sc">:</span>current_train_end_idx]</span>
<span id="cb53-127"><a href="#cb53-127" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { <span class="co"># expanding</span></span>
<span id="cb53-128"><a href="#cb53-128" aria-hidden="true" tabindex="-1"></a>        train_data <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span>current_train_end_idx]</span>
<span id="cb53-129"><a href="#cb53-129" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-130"><a href="#cb53-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-131"><a href="#cb53-131" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If train_data is too short for AR(p), skip this iteration</span></span>
<span id="cb53-132"><a href="#cb53-132" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(train_data) <span class="sc">&lt;=</span> p) {</span>
<span id="cb53-133"><a href="#cb53-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Training data (length:"</span>, <span class="fu">length</span>(train_data), <span class="st">") too short for AR("</span>, p, <span class="st">") for current window (end:"</span>, <span class="fu">time</span>(data)[current_train_end_idx], <span class="st">"). Skipping forecast."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-134"><a href="#cb53-134" aria-hidden="true" tabindex="-1"></a>        forecasts_for_p[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-135"><a href="#cb53-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb53-136"><a href="#cb53-136" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-137"><a href="#cb53-137" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(train_data)) <span class="sc">&lt;</span> <span class="dv">2</span>) { <span class="co"># Check for constant data, which can break lm</span></span>
<span id="cb53-138"><a href="#cb53-138" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Training data is constant for AR("</span>, p, <span class="st">") for current window (end:"</span>, <span class="fu">time</span>(data)[current_train_end_idx], <span class="st">"). Skipping forecast."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-139"><a href="#cb53-139" aria-hidden="true" tabindex="-1"></a>        forecasts_for_p[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-140"><a href="#cb53-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb53-141"><a href="#cb53-141" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-142"><a href="#cb53-142" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-143"><a href="#cb53-143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create lagged variables for lm</span></span>
<span id="cb53-144"><a href="#cb53-144" aria-hidden="true" tabindex="-1"></a>      lag_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(train_data) <span class="sc">-</span> p, <span class="at">ncol =</span> p)</span>
<span id="cb53-145"><a href="#cb53-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb53-146"><a href="#cb53-146" aria-hidden="true" tabindex="-1"></a>        lag_matrix[, j] <span class="ot">&lt;-</span> train_data[(p <span class="sc">-</span> j <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(train_data) <span class="sc">-</span> j)]</span>
<span id="cb53-147"><a href="#cb53-147" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-148"><a href="#cb53-148" aria-hidden="true" tabindex="-1"></a>      ar_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> train_data[(p <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(train_data)], lag_matrix)</span>
<span id="cb53-149"><a href="#cb53-149" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(ar_df)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>, <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb53-150"><a href="#cb53-150" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-151"><a href="#cb53-151" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fit AR(p) model using lm</span></span>
<span id="cb53-152"><a href="#cb53-152" aria-hidden="true" tabindex="-1"></a>      lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> ., <span class="at">data =</span> ar_df)</span>
<span id="cb53-153"><a href="#cb53-153" aria-hidden="true" tabindex="-1"></a>      lm_coeffs <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm_model)</span>
<span id="cb53-154"><a href="#cb53-154" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-155"><a href="#cb53-155" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle cases where some coefficients might be NA</span></span>
<span id="cb53-156"><a href="#cb53-156" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(lm_coeffs))) {</span>
<span id="cb53-157"><a href="#cb53-157" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Model fitting failed (NA coefficients) for AR("</span>, p, <span class="st">") at current window (end:"</span>, <span class="fu">time</span>(data)[current_train_end_idx], <span class="st">"). Skipping forecast."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-158"><a href="#cb53-158" aria-hidden="true" tabindex="-1"></a>        forecasts_for_p[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-159"><a href="#cb53-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb53-160"><a href="#cb53-160" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-161"><a href="#cb53-161" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-162"><a href="#cb53-162" aria-hidden="true" tabindex="-1"></a>      lm_intercept <span class="ot">&lt;-</span> lm_coeffs[<span class="dv">1</span>]</span>
<span id="cb53-163"><a href="#cb53-163" aria-hidden="true" tabindex="-1"></a>      lm_ar_coeffs <span class="ot">&lt;-</span> lm_coeffs[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb53-164"><a href="#cb53-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-165"><a href="#cb53-165" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Store the last p observations from the training data for forecasting</span></span>
<span id="cb53-166"><a href="#cb53-166" aria-hidden="true" tabindex="-1"></a>      forecast_input_values <span class="ot">&lt;-</span> <span class="fu">tail</span>(train_data, p)</span>
<span id="cb53-167"><a href="#cb53-167" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-168"><a href="#cb53-168" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Forecast h steps ahead</span></span>
<span id="cb53-169"><a href="#cb53-169" aria-hidden="true" tabindex="-1"></a>      h_step_forecast_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(forecast_horizon)</span>
<span id="cb53-170"><a href="#cb53-170" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-171"><a href="#cb53-171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (h_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>forecast_horizon) {</span>
<span id="cb53-172"><a href="#cb53-172" aria-hidden="true" tabindex="-1"></a>        values_to_use_for_h_step <span class="ot">&lt;-</span> <span class="fu">numeric</span>(p)</span>
<span id="cb53-173"><a href="#cb53-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb53-174"><a href="#cb53-174" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (h_idx <span class="sc">-</span> j <span class="sc">&gt;=</span> <span class="dv">1</span>) { <span class="co"># Use previous forecasts from this h-step sequence</span></span>
<span id="cb53-175"><a href="#cb53-175" aria-hidden="true" tabindex="-1"></a>            values_to_use_for_h_step[j] <span class="ot">&lt;-</span> h_step_forecast_values[h_idx <span class="sc">-</span> j]</span>
<span id="cb53-176"><a href="#cb53-176" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> { <span class="co"># Use actual observed values from forecast_input_values</span></span>
<span id="cb53-177"><a href="#cb53-177" aria-hidden="true" tabindex="-1"></a>            values_to_use_for_h_step[j] <span class="ot">&lt;-</span> forecast_input_values[<span class="fu">abs</span>(h_idx <span class="sc">-</span> j) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb53-178"><a href="#cb53-178" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb53-179"><a href="#cb53-179" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb53-180"><a href="#cb53-180" aria-hidden="true" tabindex="-1"></a>        h_step_forecast_values[h_idx] <span class="ot">&lt;-</span> lm_intercept <span class="sc">+</span> <span class="fu">sum</span>(lm_ar_coeffs <span class="sc">*</span> values_to_use_for_h_step)</span>
<span id="cb53-181"><a href="#cb53-181" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-182"><a href="#cb53-182" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb53-183"><a href="#cb53-183" aria-hidden="true" tabindex="-1"></a>      forecasts_for_p[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> h_step_forecast_values[forecast_horizon]</span>
<span id="cb53-184"><a href="#cb53-184" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-185"><a href="#cb53-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-186"><a href="#cb53-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate MSFE for the specific horizon h</span></span>
<span id="cb53-187"><a href="#cb53-187" aria-hidden="true" tabindex="-1"></a>    start_actual_index <span class="ot">&lt;-</span> initial_train_size <span class="sc">+</span> forecast_horizon</span>
<span id="cb53-188"><a href="#cb53-188" aria-hidden="true" tabindex="-1"></a>    end_actual_index <span class="ot">&lt;-</span> start_actual_index <span class="sc">+</span> <span class="fu">length</span>(forecasts_for_p) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb53-189"><a href="#cb53-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-190"><a href="#cb53-190" aria-hidden="true" tabindex="-1"></a>    end_actual_index <span class="ot">&lt;-</span> <span class="fu">min</span>(end_actual_index, n) <span class="co"># Ensure end_actual_index does not exceed data length</span></span>
<span id="cb53-191"><a href="#cb53-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-192"><a href="#cb53-192" aria-hidden="true" tabindex="-1"></a>    actuals_for_comparison <span class="ot">&lt;-</span> data[start_actual_index<span class="sc">:</span>end_actual_index]</span>
<span id="cb53-193"><a href="#cb53-193" aria-hidden="true" tabindex="-1"></a>    valid_forecasts <span class="ot">&lt;-</span> forecasts_for_p[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(actuals_for_comparison)] <span class="co"># Trim forecasts if actuals vector is shorter</span></span>
<span id="cb53-194"><a href="#cb53-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-195"><a href="#cb53-195" aria-hidden="true" tabindex="-1"></a>    valid_indices <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(valid_forecasts)</span>
<span id="cb53-196"><a href="#cb53-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(valid_indices) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb53-197"><a href="#cb53-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"No valid forecasts generated for AR("</span>, p, <span class="st">"). MSFE cannot be computed."</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb53-198"><a href="#cb53-198" aria-hidden="true" tabindex="-1"></a>      all_msfe[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")"</span>)]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-199"><a href="#cb53-199" aria-hidden="true" tabindex="-1"></a>      all_forecasts[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")_series"</span>)]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb53-200"><a href="#cb53-200" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb53-201"><a href="#cb53-201" aria-hidden="true" tabindex="-1"></a>      msfe <span class="ot">&lt;-</span> <span class="fu">mean</span>((actuals_for_comparison[valid_indices]<span class="sc">-</span>valid_forecasts[valid_indices])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb53-202"><a href="#cb53-202" aria-hidden="true" tabindex="-1"></a>      all_msfe[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")"</span>)]] <span class="ot">&lt;-</span> msfe</span>
<span id="cb53-203"><a href="#cb53-203" aria-hidden="true" tabindex="-1"></a>      all_forecasts[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")_series"</span>)]] <span class="ot">&lt;-</span> valid_forecasts</span>
<span id="cb53-204"><a href="#cb53-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-205"><a href="#cb53-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-206"><a href="#cb53-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">") Forecasts Generated. MSFE (h="</span>, forecast_horizon, <span class="st">"): "</span>, <span class="fu">round</span>(all_msfe[[<span class="fu">paste0</span>(<span class="st">"AR("</span>, p, <span class="st">")"</span>)]], <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="co"># More precision for MSFE</span></span>
<span id="cb53-207"><a href="#cb53-207" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-208"><a href="#cb53-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-209"><a href="#cb53-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plotting results</span></span>
<span id="cb53-210"><a href="#cb53-210" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (plot_results <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(all_msfe) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb53-211"><a href="#cb53-211" aria-hidden="true" tabindex="-1"></a>    plot_start_idx <span class="ot">&lt;-</span> initial_train_size <span class="sc">+</span> forecast_horizon</span>
<span id="cb53-212"><a href="#cb53-212" aria-hidden="true" tabindex="-1"></a>    plot_end_idx <span class="ot">&lt;-</span> n</span>
<span id="cb53-213"><a href="#cb53-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (plot_start_idx <span class="sc">&gt;</span> plot_end_idx <span class="sc">||</span> <span class="fu">length</span>(data[plot_start_idx<span class="sc">:</span>plot_end_idx]) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb53-214"><a href="#cb53-214" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">"Not enough data to plot forecasts in the test period."</span>)</span>
<span id="cb53-215"><a href="#cb53-215" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">msfe_results =</span> all_msfe, <span class="at">all_forecast_series =</span> all_forecasts))</span>
<span id="cb53-216"><a href="#cb53-216" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-217"><a href="#cb53-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-218"><a href="#cb53-218" aria-hidden="true" tabindex="-1"></a>    x_axis_labels <span class="ot">&lt;-</span> <span class="fu">time</span>(data)[plot_start_idx<span class="sc">:</span>plot_end_idx] <span class="co"># Use time attributes for x-axis</span></span>
<span id="cb53-219"><a href="#cb53-219" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-220"><a href="#cb53-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb53-221"><a href="#cb53-221" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-222"><a href="#cb53-222" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Collect all forecast series to determine appropriate y-axis limits</span></span>
<span id="cb53-223"><a href="#cb53-223" aria-hidden="true" tabindex="-1"></a>    all_plot_values <span class="ot">&lt;-</span> <span class="fu">c</span>(data[plot_start_idx<span class="sc">:</span>plot_end_idx])</span>
<span id="cb53-224"><a href="#cb53-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(s_name <span class="cf">in</span> <span class="fu">names</span>(all_forecasts)) {</span>
<span id="cb53-225"><a href="#cb53-225" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(all_forecasts[[s_name]][<span class="dv">1</span>])) { <span class="co"># Only add non-NA series</span></span>
<span id="cb53-226"><a href="#cb53-226" aria-hidden="true" tabindex="-1"></a>        all_plot_values <span class="ot">&lt;-</span> <span class="fu">c</span>(all_plot_values, all_forecasts[[s_name]])</span>
<span id="cb53-227"><a href="#cb53-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-228"><a href="#cb53-228" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-229"><a href="#cb53-229" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-230"><a href="#cb53-230" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(x_axis_labels, data[plot_start_idx<span class="sc">:</span>plot_end_idx], <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb53-231"><a href="#cb53-231" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Date"</span>, <span class="at">ylab =</span> <span class="st">"GDP Growth (%)"</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Actual vs. Forecasts (h="</span>, forecast_horizon, <span class="st">", "</span>, window_type, <span class="st">" window)"</span>),</span>
<span id="cb53-232"><a href="#cb53-232" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim =</span> <span class="fu">range</span>(x_axis_labels),</span>
<span id="cb53-233"><a href="#cb53-233" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">range</span>(all_plot_values, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># Dynamically adjust ylim based on all valid series</span></span>
<span id="cb53-234"><a href="#cb53-234" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-235"><a href="#cb53-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-236"><a href="#cb53-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add initial training end marker</span></span>
<span id="cb53-237"><a href="#cb53-237" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">time</span>(data)[initial_train_size], <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb53-238"><a href="#cb53-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="fu">time</span>(data)[initial_train_size], <span class="fu">par</span>(<span class="st">"usr"</span>)[<span class="dv">4</span>], <span class="st">"Train End"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb53-239"><a href="#cb53-239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-240"><a href="#cb53-240" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot forecasts</span></span>
<span id="cb53-241"><a href="#cb53-241" aria-hidden="true" tabindex="-1"></a>    p_val_names <span class="ot">&lt;-</span> <span class="fu">names</span>(all_msfe) <span class="co"># Use the names from MSFE list</span></span>
<span id="cb53-242"><a href="#cb53-242" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">length</span>(p_val_names))</span>
<span id="cb53-243"><a href="#cb53-243" aria-hidden="true" tabindex="-1"></a>    lty_values <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(p_val_names) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb53-244"><a href="#cb53-244" aria-hidden="true" tabindex="-1"></a>    legend_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Actual"</span>)</span>
<span id="cb53-245"><a href="#cb53-245" aria-hidden="true" tabindex="-1"></a>    legend_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"black"</span>)</span>
<span id="cb53-246"><a href="#cb53-246" aria-hidden="true" tabindex="-1"></a>    legend_lwd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>)</span>
<span id="cb53-247"><a href="#cb53-247" aria-hidden="true" tabindex="-1"></a>    legend_lty <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb53-248"><a href="#cb53-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-249"><a href="#cb53-249" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(p_val_names)) {</span>
<span id="cb53-250"><a href="#cb53-250" aria-hidden="true" tabindex="-1"></a>      p_str <span class="ot">&lt;-</span> p_val_names[k]</span>
<span id="cb53-251"><a href="#cb53-251" aria-hidden="true" tabindex="-1"></a>      forecast_values <span class="ot">&lt;-</span> all_forecasts[[<span class="fu">paste0</span>(p_str, <span class="st">"_series"</span>)]] <span class="co"># Retrieve the actual series</span></span>
<span id="cb53-252"><a href="#cb53-252" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(forecast_values) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(forecast_values[<span class="dv">1</span>])) {</span>
<span id="cb53-253"><a href="#cb53-253" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(x_axis_labels[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(forecast_values)], forecast_values, <span class="at">col =</span> colors[k], <span class="at">lty =</span> lty_values[k], <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb53-254"><a href="#cb53-254" aria-hidden="true" tabindex="-1"></a>        legend_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(legend_labels, p_str)</span>
<span id="cb53-255"><a href="#cb53-255" aria-hidden="true" tabindex="-1"></a>        legend_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(legend_cols, colors[k])</span>
<span id="cb53-256"><a href="#cb53-256" aria-hidden="true" tabindex="-1"></a>        legend_lwd <span class="ot">&lt;-</span> <span class="fu">c</span>(legend_lwd, <span class="dv">1</span>)</span>
<span id="cb53-257"><a href="#cb53-257" aria-hidden="true" tabindex="-1"></a>        legend_lty <span class="ot">&lt;-</span> <span class="fu">c</span>(legend_lty, lty_values[k])</span>
<span id="cb53-258"><a href="#cb53-258" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb53-259"><a href="#cb53-259" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-260"><a href="#cb53-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> legend_labels, <span class="at">col =</span> legend_cols, <span class="at">lwd =</span> legend_lwd, <span class="at">lty =</span> legend_lty, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb53-261"><a href="#cb53-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-262"><a href="#cb53-262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="co"># Reset plot layout</span></span>
<span id="cb53-263"><a href="#cb53-263" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-264"><a href="#cb53-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-265"><a href="#cb53-265" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return only MSFE values in the main list, and forecasts in a sub-list if needed</span></span>
<span id="cb53-266"><a href="#cb53-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">msfe_results =</span> all_msfe, <span class="at">all_forecast_series =</span> all_forecasts))</span>
<span id="cb53-267"><a href="#cb53-267" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-268"><a href="#cb53-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-269"><a href="#cb53-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-270"><a href="#cb53-270" aria-hidden="true" tabindex="-1"></a><span class="co"># --- OUT-OF-SAMPLE FORECASTING FOR GDP GROWTH ---</span></span>
<span id="cb53-271"><a href="#cb53-271" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">#####################################################"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

#####################################################</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### RUNNING OUT-OF-SAMPLE FORECASTING FOR GDP GROWTH ###"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
### RUNNING OUT-OF-SAMPLE FORECASTING FOR GDP GROWTH ###</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">#####################################################</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
#####################################################</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;&gt;&gt; SELECTION OF TRAINING (ESTIMATION) AND FORECASTING (</span><span class="al">TEST</span><span class="co">) SAMPLE &lt;&lt;&lt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is where you define the split between your initial estimation period</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and where the out-of-sample forecasting exercise begins.</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This selection operates *within* the 'gdp_growth' series defined in the</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 'DATA ACQUISITION AND PREPARATION' section.</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: If 'gdp_growth' runs from 1985 Q1 to 2007 Q1:</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Setting `initial_train_end_date = "2000-10-01"` means the initial</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     training sample will be from 1985 Q1 up to and including 2000 Q4.</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     (Assuming the gdp_growth series covers 2000 Q4).</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   - The out-of-sample forecasting period will then start from 2001 Q1.</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define initial training sample end by specific date (recommended for time series)</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure this date exists within the 'gdp_growth' time series.</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we end the initial training sample at the end of 2000 Q4.</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co"># (Verify that 2000-10-01 corresponds to an actual point in your 'gdp_growth' series</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co"># after differencing and NA removal.)</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">#initial_train_end_date_selected &lt;- "2000-10-01" # This corresponds to 2000 Q4 for quarterly data</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>initial_train_end_date_selected <span class="ot">&lt;-</span> <span class="st">"2009-10-01"</span> <span class="co"># </span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Forecasting Run 1: 1-Quarter Ahead Forecasts (Expanding Window) ---</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Forecasting Run 1: 1-Quarter Ahead Forecasts (Expanding Window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>gdp_forecast_results_h1 <span class="ot">&lt;-</span> <span class="fu">ar_forecast</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gdp_growth,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="co"># Explicitly requesting AR(1) to AR(4)</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_end_date =</span> initial_train_end_date_selected,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">window_type =</span> <span class="st">"expanding"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">forecast_horizon =</span> <span class="dv">1</span>, <span class="co"># 1-quarter ahead forecast</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_results =</span> <span class="cn">TRUE</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Initial Sample Selection ---
Initial training (estimation) sample ends at index: 100
Corresponding time point: 2009.75
Out-of-sample forecasting (test) period starts at index: 101
Corresponding time point: 2010

--- Forecasting for AR(1) ---
AR(1) Forecasts Generated. MSFE (h=1): 3.010018

--- Forecasting for AR(2) ---
AR(2) Forecasts Generated. MSFE (h=1): 2.810865

--- Forecasting for AR(3) ---
AR(3) Forecasts Generated. MSFE (h=1): 2.760154

--- Forecasting for AR(4) ---
AR(4) Forecasts Generated. MSFE (h=1): 3.451758</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, expanding window) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, expanding window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gdp_forecast_results_h1<span class="sc">$</span>msfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`AR(1)`
[1] 3.010018

$`AR(2)`
[1] 2.810865

$`AR(3)`
[1] 2.760154

$`AR(4)`
[1] 3.451758</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"-----------------------------------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Forecasting Run 1: 1-Quarter Ahead Forecasts (Rolling Window) ---</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Forecasting Run 1: 1-Quarter Ahead Forecasts (Rolling Window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>gdp_forecast_results_h1 <span class="ot">&lt;-</span> <span class="fu">ar_forecast</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gdp_growth,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="co"># Explicitly requesting AR(1) to AR(4)</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_end_date =</span> initial_train_end_date_selected,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">window_type =</span> <span class="st">"rolling"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">forecast_horizon =</span> <span class="dv">1</span>, <span class="co"># 1-quarter ahead forecast</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_results =</span> <span class="cn">TRUE</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Initial Sample Selection ---
Initial training (estimation) sample ends at index: 100
Corresponding time point: 2009.75
Out-of-sample forecasting (test) period starts at index: 101
Corresponding time point: 2010

--- Forecasting for AR(1) ---
AR(1) Forecasts Generated. MSFE (h=1): 3.032567

--- Forecasting for AR(2) ---
AR(2) Forecasts Generated. MSFE (h=1): 2.793521

--- Forecasting for AR(3) ---
AR(3) Forecasts Generated. MSFE (h=1): 2.731007

--- Forecasting for AR(4) ---
AR(4) Forecasts Generated. MSFE (h=1): 3.481733</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, rolling window) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=1, rolling window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gdp_forecast_results_h1<span class="sc">$</span>msfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`AR(1)`
[1] 3.032567

$`AR(2)`
[1] 2.793521

$`AR(3)`
[1] 2.731007

$`AR(4)`
[1] 3.481733</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"-----------------------------------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Forecasting Run 2: 4-Quarter Ahead Forecasts (Expanding Window) ---</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Forecasting Run 2: 4-Quarter Ahead Forecasts (Expanding Window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>gdp_forecast_results_h4 <span class="ot">&lt;-</span> <span class="fu">ar_forecast</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gdp_growth,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="co"># Explicitly requesting AR(1) to AR(4)</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_end_date =</span> initial_train_end_date_selected, <span class="co"># Same initial training end</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">window_type =</span> <span class="st">"expanding"</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">forecast_horizon =</span> <span class="dv">4</span>, <span class="co"># 4-quarters ahead forecast</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_results =</span> <span class="cn">TRUE</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Initial Sample Selection ---
Initial training (estimation) sample ends at index: 100
Corresponding time point: 2009.75
Out-of-sample forecasting (test) period starts at index: 101
Corresponding time point: 2010

--- Forecasting for AR(1) ---
AR(1) Forecasts Generated. MSFE (h=4): 2.628715

--- Forecasting for AR(2) ---
AR(2) Forecasts Generated. MSFE (h=4): 2.662022

--- Forecasting for AR(3) ---
AR(3) Forecasts Generated. MSFE (h=4): 2.457973

--- Forecasting for AR(4) ---
AR(4) Forecasts Generated. MSFE (h=4): 2.467844</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, expanding window) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, expanding window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gdp_forecast_results_h4<span class="sc">$</span>msfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`AR(1)`
[1] 2.628715

$`AR(2)`
[1] 2.662022

$`AR(3)`
[1] 2.457973

$`AR(4)`
[1] 2.467844</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"-----------------------------------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Forecasting Run 2: 4-Quarter Ahead Forecasts (Rolling Window) ---</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Forecasting Run 2: 4-Quarter Ahead Forecasts (Rolling Window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>gdp_forecast_results_h4 <span class="ot">&lt;-</span> <span class="fu">ar_forecast</span>(</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gdp_growth,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="co"># Explicitly requesting AR(1) to AR(4)</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_end_date =</span> initial_train_end_date_selected, <span class="co"># Same initial training end</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">window_type =</span> <span class="st">"rolling"</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">forecast_horizon =</span> <span class="dv">4</span>, <span class="co"># 4-quarters ahead forecast</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_results =</span> <span class="cn">TRUE</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Initial Sample Selection ---
Initial training (estimation) sample ends at index: 100
Corresponding time point: 2009.75
Out-of-sample forecasting (test) period starts at index: 101
Corresponding time point: 2010

--- Forecasting for AR(1) ---
AR(1) Forecasts Generated. MSFE (h=4): 2.602836

--- Forecasting for AR(2) ---
AR(2) Forecasts Generated. MSFE (h=4): 2.633853

--- Forecasting for AR(3) ---
AR(3) Forecasts Generated. MSFE (h=4): 2.496958

--- Forecasting for AR(4) ---
AR(4) Forecasts Generated. MSFE (h=4): 2.478106</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch8_files/figure-html/unnamed-chunk-2-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, rolling window) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MSFE Results for AR(1), AR(2), AR(3), AR(4) (h=4, rolling window) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gdp_forecast_results_h4<span class="sc">$</span>msfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`AR(1)`
[1] 2.602836

$`AR(2)`
[1] 2.633853

$`AR(3)`
[1] 2.496958

$`AR(4)`
[1] 2.478106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"-----------------------------------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessing specific MSFE values:</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_forecast_results_h1$msfe_results$`AR(1)`</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_forecast_results_h4$msfe_results$`AR(4)`</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessing specific forecast series:</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_forecast_results_h1$all_forecast_series$`AR(2)_series`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="toggle-button" onclick="toggleCode('Extra12')">
Extra: Notes for attached out-of-sample forecasting code
</div>
<div id="Extra12" style="display:none;">
<p>Connecting to the Provided R Code</p>
<p>The R program, specifically the <code>ar_forecast</code> function, implements the pseudo out-of-sample forecasting methodology for Autoregressive (AR) models as described above.</p>
<ol type="1">
<li><p><strong>Data Acquisition and Preparation:</strong> The initial section of the R code, labelled <code>DATA ACQUISITION AND PREPARATION</code>, loads the <code>GDPC1-qdata.xlsx</code> file and transforms it into the <code>gdp_growth</code> time series. This <code>gdp_growth</code> series represents the <em>full dataset</em> available for the forecasting exercise. All subsequent training and test sample selections operate <em>within the bounds</em> of this <code>gdp_growth</code> series.</p></li>
<li><p><strong>Initial Training and Test Sample Selection:</strong> The section <code>&gt;&gt;&gt; SELECTION OF TRAINING (ESTIMATION) AND FORECASTING (TEST) SAMPLE &lt;&lt;&lt;</code> within the R code is crucial for defining the initial split. Here, you specify the <code>initial_train_end_date_selected</code> (or <code>initial_train_end_idx_selected</code>).</p>
<ul>
<li><strong>Initial Training Sample (Estimation Sample):</strong> The data from the beginning of <code>gdp_growth</code> up to and including the <code>initial_train_end_date_selected</code> comprises the initial training sample (our <span class="math inline">\(y_1, \dots, y_T\)</span>).</li>
<li><strong>Forecasting (Test) Sample:</strong> The data <em>after</em> <code>initial_train_end_date_selected</code> up to the end of the <code>gdp_growth</code> series forms the basis of the out-of-sample test period. The first forecast in the evaluation will be made for the observation immediately following <code>initial_train_end_date_selected</code>.</li>
</ul></li>
<li><p><strong>Parameters in <code>ar_forecast</code>:</strong></p>
<ul>
<li><code>data = gdp_growth</code>: This is your <span class="math inline">\(y_1, \dots, y_N\)</span> series.</li>
<li><code>p_values = c(1, 2, 3, 4)</code>: This allows you to compare the forecasting performance of AR(1), AR(2), AR(3), and AR(4) models simultaneously.</li>
<li><code>train_end_date = initial_train_end_date_selected</code>: This directly sets the <span class="math inline">\(T\)</span> value, defining the end of your initial estimation period.</li>
<li><code>window_type = "rolling"</code> (or <code>"expanding"</code>): Corresponds directly to the parameter updating strategies discussed above.</li>
<li><code>forecast_horizon = 1</code> (or <code>4</code>): This sets your <span class="math inline">\(h\)</span> value (e.g., <span class="math inline">\(h=1\)</span> for one-quarter-ahead forecasts, <span class="math inline">\(h=4\)</span> for four-quarter-ahead forecasts).</li>
<li>The <code>ar_forecast</code> function then iteratively:
<ul>
<li>Estimates an AR(p) model on the current training window.</li>
<li>Generates an <span class="math inline">\(h\)</span>-step ahead forecast.</li>
<li>Calculates the forecast error.</li>
<li>Updates the training window according to <code>window_type</code>.</li>
</ul></li>
</ul></li>
<li><p><strong>MSFE Calculation and Reporting:</strong> The function automatically computes the MSFE for each AR(p) model and each specified <code>forecast_horizon</code> over the entire out-of-sample period (which contains <span class="math inline">\(m\)</span> forecast origins). The results, specifically the MSFE values, are returned and printed by the R script, allowing for direct comparison of model performance.</p></li>
</ol>
<p>By running the accompanying R code, you can practically apply these theoretical concepts to evaluate the out-of-sample forecasting capabilities of different AR(p) models for GDP growth, understanding how parameter updating and forecast horizons influence performance.</p>
</div>
<p>&nbsp;</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./TSE-ch7.html" class="pagination-link" aria-label="Model selection of ARMA model">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./TSE-ch9.html" class="pagination-link" aria-label="Volatility modelling: AR-GARCH model">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Volatility modelling: AR-GARCH model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>