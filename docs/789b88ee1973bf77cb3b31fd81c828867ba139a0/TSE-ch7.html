<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Model selection of ARMA model – Time Series Econometrics (TSE)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./TSE-ch8.html" rel="next">
<link href="./TSE-ch6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<!-- Use JavaScript to Disable Right-Click -->
<script>
document.addEventListener('contextmenu', event => event.preventDefault());
</script>

<!-- Custom JavaScript for toggling code visibility -->
<script>
function toggleCode(id) {
  var x = document.getElementById(id);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>


<!-- Visibility selections. display: none;? 
  <style>

/* Initially hide elements */
.marginnotevideo {
  display: none;
}

.marginnote {
  display: none;
}

  </style>
-->
</head><body class="nav-sidebar docked">\usepackage{amsmath}
\newcommand{\ubar}[1]{\mkern3mu\underline{\mkern-3mu#1\mkern-3mu}\mkern3mu}

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles-TSE.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./TSE-ch7.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Time Series Econometrics (TSE)</a> 
        <div class="sidebar-tools-main">
    <a href="./msTSE2025.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Time Series Econometrics (TSE)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A primer on time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ARMA processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Parameter estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Volatility modelling: AR-GARCH model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multivariate time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Basics of vector autoregression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Nonstationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear regressions with I(1) variables</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#starting-point" id="toc-starting-point" class="nav-link active" data-scroll-target="#starting-point"><span class="header-section-number">8.1</span> Starting point</a></li>
  <li><a href="#sample-autocorrelations-and-partial-autocorrelations" id="toc-sample-autocorrelations-and-partial-autocorrelations" class="nav-link" data-scroll-target="#sample-autocorrelations-and-partial-autocorrelations"><span class="header-section-number">8.2</span> Sample autocorrelations and partial autocorrelations</a></li>
  <li><a href="#information-criteria-and-sequential-tests" id="toc-information-criteria-and-sequential-tests" class="nav-link" data-scroll-target="#information-criteria-and-sequential-tests"><span class="header-section-number">8.3</span> Information criteria and sequential tests</a></li>
  <li><a href="#evaluating-the-adequacy-of-the-estimated-model" id="toc-evaluating-the-adequacy-of-the-estimated-model" class="nav-link" data-scroll-target="#evaluating-the-adequacy-of-the-estimated-model"><span class="header-section-number">8.4</span> Evaluating the adequacy of the estimated model</a></li>
  <li><a href="#r-lab" id="toc-r-lab" class="nav-link" data-scroll-target="#r-lab"><span class="header-section-number">8.5</span> R Lab</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="part-ch7" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="starting-point" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="starting-point"><span class="header-section-number">8.1</span> Starting point</h2>
<p>Consider an observed time series <span class="math inline">\(y_{1},\ldots,y_{T}\)</span>, which is assumed (e.g., judging by its graph) to be generated by a stationary process, and whose modelling as some ARMA(<span class="math inline">\(p,q\)</span>) process appears reasonable.</p>
<ul>
<li><p>As has been mentioned above, to achieve this some preliminary transformations may be required, such as via differencing related to ARIMA(<span class="math inline">\(p,d,q\)</span>) and/or nonstationary (unit root) processes (to be introduced later on this material). The most common examples of such transformations are taking differences (potentially combined with taking logarithms) and eliminating a deterministic trend by relevant detrending method.</p></li>
<li><p>In the case of a process following a deterministic linear trend, the model would then be <span class="math inline">\(y_{t}= \nu +  \delta t + z_{t}\)</span>, <span class="math inline">\(t\)</span> <span class="math inline">\(=1,\ldots,T\)</span>, where <span class="math inline">\(z_{t}\)</span> is an ARMA(<span class="math inline">\(p,q\)</span>) process (cf.&nbsp;the decomposition <span class="math inline">\(y_t = \mu_t + z_t\)</span>). This is an example of so called <strong>trend-stationary process</strong>. The idea is to estimate the parameters <span class="math inline">\(\nu\)</span> and <span class="math inline">\(\delta\)</span> using least squares, and then move on to consider the obtained series of residuals. From the point of view of parameter estimation, this amounts to modelling the deterministic part via parameters <span class="math inline">\(\nu\)</span> and <span class="math inline">\(\delta\)</span> (related to <span class="math inline">\(\mu_t\)</span>), and the parameters of the ARMA(<span class="math inline">\(p,q\)</span>) process <span class="math inline">\(z_{t}\)</span> separately. An obvious alternative would be to estimate all these parameters jointly.</p></li>
</ul>
<!-- This alternative is not discussed in this course, except for the special case where $\beta$ is restricted to equal zero, and the residual series equals demeaned time series $y_{t}-\bar{y}$! -->
<p>&nbsp;</p>
<p>Finding a suitable ARMA(<span class="math inline">\(p,q\)</span>) process or, using terminology often used in connection with statistical modelling, an <strong>ARMA(<span class="math inline">\(p,q\)</span>) model</strong>, traditionally consists of the following stages (that are partially related with each other):</p>
<ol type="1">
<li><p>Specifying (selecting) the model orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span></p></li>
<li><p>Estimation of model parameters (including possible preliminary estimation of parameters)</p></li>
<li><p>Evaluating the sufficiency of the estimated model by model diagnostic checks and at times forecasting performance</p></li>
</ol>
<p>If the estimated model is found insufficient in Step 3, one has to select a new model, that is new orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>, re-estimate the parameters and evaluate sufficiency of the model. As mentioned above, Steps 1–3 are related with each other and are not always performed separately or in this order.</p>
<p><strong>In practice, one can never know with certainty whether the true (correct) orders of the ARMA(<span class="math inline">\(p,q\)</span>) model have been found</strong>.</p>
<ul>
<li><p>If the orders are chosen too small, then some aspects of the autocorrelation structure of the time series remain unmodelled, which is obviously not optimal, especially from strict and careful modelling and perhaps also from forecasting perspective. This may lead one to think, to be on the safe side, that it would be best to choose the orders large that there is no possibility of having chosen them too small. However, using orders that are too large leads to inefficiency in parameter estimation, which may lead to, for example, decreasing accuracy in forecasting.</p></li>
<li><p>It is particularly harmful if both orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> are chosen too large, because this leads to a model in which <span class="math inline">\(\phi_{p}=0=\theta_{q}\)</span> so that the model parameters are not identified (see the identification condition of the ARMA process) and meaningful estimation of them is not possible.</p></li>
</ul>
<p>For these reasons, it is often advisable to follow the <strong>principle of parsimony</strong> and choose a model that is as simple as possible while being sufficiently large and adequate for the data.</p>
<p>&nbsp;</p>
<p><strong>In what follows in this section</strong> is that the error term is assumed to satisfy <span class="math inline">\(u_{t}\sim\mathsf{iid}\left(0,\sigma^{2}\right)\)</span>, and in connection with maximum likelihood estimation, the even stronger assumption <span class="math inline">\(u_{t}\sim\mathsf{nid}\left(0,\sigma^{2}\right)\)</span>.</p>
<ul>
<li>Unless otherwise mentioned, it is also assumed that the stationarity and invertibility conditions hold.</li>
</ul>
<p>&nbsp;</p>
<p><strong>Constant term or demeaning?</strong>. As discussed, the mean <span class="math inline">\(\mathsf{E}(y_t)=\mu\)</span> is typically nonzero, which means that we need to include a constant term to the model, or alternatively considered demeaned time series. Some clarifying points from empirical modelling perspective:</p>
<ul>
<li><p>The mean is typically estimated using the sample mean <span class="math inline">\(\bar{y}\)</span>, after which one may consider the <strong>centered time series</strong> <span class="math inline">\(y_{t}-\bar{y}\)</span>, <span class="math inline">\(t=1,\ldots,T\)</span>, and acts as if <span class="math inline">\(\bar{y}\)</span>&nbsp;would exactly equal the unknown <span class="math inline">\(\mu\)</span>. This leads to a slight error, but it can be shown that in large samples this error is negligible.</p></li>
<li><p><strong>If not centering the time series process, you should always include the constant term</strong> to the model equation, as followed in our notation above when introducing different ARMA processes.</p></li>
</ul>
<p>&nbsp;</p>
</section>
<section id="sample-autocorrelations-and-partial-autocorrelations" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="sample-autocorrelations-and-partial-autocorrelations"><span class="header-section-number">8.2</span> Sample autocorrelations and partial autocorrelations</h2>
<p>A good second step after visualizing the series is to investigate the autocorrelation structure of the time series using the estimated (sample) autocorrelation function (ACF) and partial autocorrelation function (PACF). In many cases, these functions may contain clues regarding the suitable lag lengths <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> concerning an adequate ARMA(<span class="math inline">\(p,q\)</span>) model.</p>
<p>In particular, recall what we have learned about the theoretical properties of AR, MA and ARMA processes! That is, <strong>one should look for potential breaks (“sudden drops to zero”) in the sample autocorrelation and sample partial autocorrelation functions</strong>.</p>
<ul>
<li><p>A break in the sample autocorrelation function, but not in the sample partial autocorrelations, suggests that an MA(<span class="math inline">\(q\)</span>) model may be a suitable.</p></li>
<li><p>With an AR(<span class="math inline">\(p\)</span>) case, the properties are completely other way round. That is, we should see a break in the sample PACF but not in the sample ACF.</p></li>
<li><p>If there are no clear breaks (and behavior as described above for MA or AR processes), an ARMA process appears as a likely candidate model.</p></li>
</ul>
<p>In other words, in summary, an AR(<span class="math inline">\(p\)</span>) process is described by an ACF that is infinite in extent (it tails off), but a PACF that is (close to) zero for lags larger than <span class="math inline">\(p\)</span>. Moreover, for an MA(<span class="math inline">\(q\)</span>) process we have and ACF that is (close to) zero for lags larger than <span class="math inline">\(q\)</span> and a PACF that is infinite in extent (it tails off). In the absence of either of these two situations, an ARMA model might be an adequate model.</p>
<p>This is so called <strong>Box-Jenkins model selection procedure</strong>. Although quite often this procedure does not point to a single particular candidate model, it may help by ruling out some model alternatives and may be helpful as a tool to be used jointly with other model selection criteria to be introduced below.</p>
<p>&nbsp;</p>
</section>
<section id="information-criteria-and-sequential-tests" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="information-criteria-and-sequential-tests"><span class="header-section-number">8.3</span> Information criteria and sequential tests</h2>
<p>Likewise using sample ACF and PACF, the purpose here is to select the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> of the ARMA(<span class="math inline">\(p,q\)</span>) model after one has first set “sufficiently large” maximum lag lengths <span class="math inline">\(p^{\ast}\)</span>&nbsp;and <span class="math inline">\(q^{\ast}\)</span>. This preliminary selection can be made, for instance, by making use of the sample autocorrelation and partial autocorrelation functions.</p>
<ul>
<li><p>Let <span class="math inline">\(\tilde{\sigma}_{p,q}^{2}\)</span>&nbsp;(<span class="math inline">\(0\leq p\leq p^{\ast}\)</span>, <span class="math inline">\(0\leq q\leq q^{\ast}\)</span>) be the estimator of the innovation variance <span class="math inline">\(\sigma^{2}\)</span> of an ARMA(<span class="math inline">\(p,q\)</span>) process.</p></li>
<li><p>Suppose also that the quantity <span class="math inline">\(m&gt;\max\left(p^{\ast},q^{\ast}\right)\)</span> used in this estimation method is held constant for all attempted values of <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>.</p></li>
</ul>
<p>As discussed, it is preferable to avoid choosing <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> too large.</p>
<ul>
<li>One possible way to choose <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> would be to minimize <span class="math inline">\(\tilde{\sigma}_{p,q}^{2}\)</span>&nbsp;over the possible values <span class="math inline">\(0\leq p\leq p^{\ast}\)</span>, <span class="math inline">\(0\leq q\leq q^{\ast}\)</span>. However, this approach does not work, because due to the nature of the least squares or maximum likelihood method, this would lead one to choose orders too large.</li>
</ul>
<p>To fix this obvious problem, one approach to select the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> is to minimize the function <span class="math display">\[\begin{equation}
    C\left(p,q\right)  =\log\tilde{\sigma}_{p,q}^{2}+ \frac{\left(p+q+1\right)  g\left(  T\right)}{T}, \quad 0\leq p\leq p^{\ast},0\leq q\leq q^{\ast},
\end{equation}\]</span> where the so-called <strong>penalty function</strong> <span class="math inline">\(g\left(\cdot\right)\)</span> is positive valued and satisfies <span class="math inline">\(g\left(  T\right)  /T\rightarrow0\)</span> as <span class="math inline">\(T\rightarrow \infty\)</span> (“+1” due to the inclusion of the constant term <span class="math inline">\(\nu\)</span>). The idea behind the penalty function is to penalize for using an unnecessarily large model. If increasing the order <span class="math inline">\(p\)</span> or <span class="math inline">\(q\)</span> does not make <span class="math inline">\(\tilde{\sigma}_{p,q}^{2}\)</span> sufficiently much smaller, then one does not choose the larger model.</p>
<p>Typically used penalty functions (which have been derived based on different principles) are:</p>
<ul>
<li><p>AIC: <span class="math inline">\(g\left( T\right) =2\)</span> (Akaike information criterion)</p></li>
<li><p>HQ: <span class="math inline">\(g\left( T\right) =2\log (\log T)\)</span> (Hannan and Quinn information criterion)</p></li>
<li><p>BIC: <span class="math inline">\(g\left( T\right) =\log T\)</span> (Schwarz information criterion/Bayesian information criterion)</p></li>
</ul>
<p>The first of these (AIC) penalizes the least (favors larger models) and the last (BIC) the most (favors smaller models).</p>
<ul>
<li>We note that of the HQ penalty function, there exist also other versions in which the constant 2 has been replaced by some other constants.</li>
</ul>
<p>&nbsp;</p>
<p>In practice, it is often advisable to use the criteria described above only as one tool to help in model selection, and not base the selection only on mechanical minimization of the criterion <span class="math inline">\(C\left(  p,q\right)\)</span>. In principle, the final selection of the model should always be done after successful parameter estimation (i.e.&nbsp;when there are clearly no suspicious behavior in some estimates) and inspection of diagnostic check to evaluate the sufficiency of the model (see the next subsection).</p>
<p>However, a modern and partly also <strong>machine learning perspective</strong> is that information criteria or equivalent tools are often used quite mechanically to select lag lengths of the ARMA model. Even though not completely advisable, in the era of large and complicated datasets, it is not always possible (or reasonable) to perform diagnostic checking in each step.</p>
<p>&nbsp;</p>
<p><strong>Neighbouring models</strong>. In case of time series that appear difficult to model and select a suitable ARMA(<span class="math inline">\(p,q\)</span>) model, it may be useful to consider as alternatives also models in which lag lengths <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> are one larger than in the model that minimizes the criterion function.</p>
<ul>
<li>Keeping, however, in mind that selecting both orders too large can lead to identification problems as was mentioned in connection to the identification condition of the ARMA processes</li>
</ul>
<p>One may also choose a few models that correspond to the smallest values of the information criterion function (see above), and continue with these models to more detailed investigation. Finally, it is common to use several of the above-mentioned criterion functions simultaneously and see whether they indicate the same model or not.</p>
<p>&nbsp;</p>
<p><strong>Sequential tests</strong>. One way to choose the AR(<span class="math inline">\(p\)</span>) or ARMA(<span class="math inline">\(p,q\)</span>) model orders is based on sequential tests. In what follows, we will consider an AR(<span class="math inline">\(p\)</span>) model for simplicity, but the following procedure can be generalized into ARMA models too.</p>
<ul>
<li><p>Start by choosing a relatively large model order <span class="math inline">\(p*\)</span></p></li>
<li><p>Estimate an AR(<span class="math inline">\(p*\)</span>) model <span class="math display">\[\begin{equation*}
       y_t = \nu + \phi_1 y_{t-1} + \cdots + \phi_{p^*-1} y_{t- p^* +1} + \phi_{p^*} y_{t-p^*} + u_t.
  \end{equation*}\]</span></p></li>
<li><p>Test (evaluate) constraint <span class="math inline">\(H_0:\phi_{p*}=0\)</span></p></li>
<li><p>If the null hypothesis cannot be rejected, estimate an AR(<span class="math inline">\(p*-1\)</span>) model, and test for <span class="math inline">\(H_0:\phi_{p*-1}=0\)</span></p></li>
<li><p>This sequential testing procedure is carried out until we can reject the null hypothesis (get the first rejection).</p></li>
</ul>
<p>The sequential testing above can be used mechanically (notice the obvious multiple testing problem and its impact on p-values, but this is often ignored in this context) using <span class="math inline">\(t\)</span>-test or the Wald test statistics or using information criteria.</p>
<p>&nbsp;</p>
</section>
<section id="evaluating-the-adequacy-of-the-estimated-model" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="evaluating-the-adequacy-of-the-estimated-model"><span class="header-section-number">8.4</span> Evaluating the adequacy of the estimated model</h2>
<p>In the previous sections, it is assumed that the lag lengths (orders) <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> of the ARMA(<span class="math inline">\(p,q\)</span>) model have been chosen, in one way or another, that the model is adequate/sufficient. This means that the error term <span class="math inline">\(u_{t}\)</span> satisfies at least the assumption <span class="math inline">\(u_{t}\sim\mathsf{iid}\left(0,\sigma^{2}\right)\)</span>, but at the same time <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> are not, at least simultaneously, unnecessarily large.</p>
<ul>
<li>If also assuming the normality of the error term, then satisfying preferably the assumption <span class="math inline">\(u_{t}\sim\mathsf{nid}\left(0,\sigma^{2}\right)\)</span></li>
</ul>
<p>As discussed above, one often follows <strong>the principle of parsimony</strong> when choosing the model, which can sometimes leads to a model in which at least one of the orders has been chosen too small. In such a case, the error term of that selected model would remain autocorrelated, and moving to a larger model to incorporate this remaining correlation may improve, for instance, forecasting performance of the model.</p>
<!-- - Even if one has chosen the correct model orders, it may be the case that the errors are only uncorrelated, but not independent nor normally distributed, and it would be advantageous to know if this is the case. -->
<!-- When investigating the adequacy (sufficiency) of the estimated ARMA($p,q$) model, one should pay special attention to the "neighbouring" larger models ARMA($p+1$,$q$) and ARMA($p,q+1$). One could estimate these models and check whether the added AR or MA parameter is significantly different from zero. Due to the identification problem mentioned above, conventional tests do not work if the orders $p$ and $q$ are increased simultaneously (say, comparing to ARMA($p+1$,$q+1$) model), although even in this case one can use model selection criteria. -->
<p>&nbsp;</p>
<p><strong>Residuals</strong>. A natural way to investigate the adequacy of an estimated model is to use residuals, whose properties should resemble those of the theoretical error terms <span class="math inline">\(u_{t}\)</span>. As with linear regression models, residuals are acquired as the difference of the observed time series (<span class="math inline">\(y_t\)</span>) and the fitted values <span class="math inline">\(\widehat{y}_t\)</span> of the selected (adequate) and estimated ARMA model <span class="math display">\[\begin{equation*}
\widehat{u}_t = y_t - \widehat{y}_t.
\end{equation*}\]</span> In practice, one can also perform a further scaling and divide the residuals <span class="math inline">\(\widehat{u}_{t}\)</span>&nbsp;with their estimated standard error <span class="math inline">\(\widehat{\sigma}\)</span>. The <strong>standardized residuals</strong> obtained in this way, <span class="math inline">\(\widehat{u}_{t}/\widehat{\sigma}\)</span>, should in the case of a correctly specified model be approximately independent with mean zero and variance one.</p>
<p>&nbsp;</p>
<p><strong>Graphical and formal residual analysis</strong>. The first step in the investigation of the properties of the residuals is to plot their time series graph. If the estimated model is correct (or empirically more realistically “adequate/sufficient”), the time series of the residuals should not exhibit trends, cyclical components, systematic variation in their level over time, variation of the variance over time (that is, heteroskedasticity), too many outlying observations, etc.</p>
<ul>
<li>That is due to the fact that residuals <span class="math inline">\(\widehat{u}_t\)</span> should resemble assumptions made on the error term <span class="math inline">\(u_t\)</span>.</li>
</ul>
<p>In the next step, one can investigate whether the residuals are not autocorrelated. This is essentially performed in the same way as testing and investigating whether there is autocorrelation in the observed time series. In this case, the observed time series is the residual series.</p>
<ul>
<li><p>It should be noted, though, that for the autocorrelation coefficients computed from residuals, the critical bounds <span class="math inline">\(\pm1.96/\sqrt{T}\)</span>&nbsp;are not valid, not even asymptotically.</p></li>
<li><p>Expressions for the asymptotically correct critical bounds do exist, but are complicated, although some computer programs plot them automatically. If such correct bounds are not (easily) available, the somewhat incorrect bounds <span class="math inline">\(\pm1.96/\sqrt{T}\)</span>&nbsp;are sometimes used to give at least a rough measure of the significance of the autocorrelation coefficients computed from the residuals.</p></li>
</ul>
<p>In testing remaining autocorrelation in the residuals, the <strong>Ljung-Box test statistic</strong> (introduced earlier) can also be used.</p>
<ul>
<li><p>However, when considering an ARMA(<span class="math inline">\(p,q\)</span>) model with a constant term, instead of the (asymptotic) <span class="math inline">\(\chi_{H}^{2}\)</span>–distribution used earlier, one should now use the <span class="math inline">\(\chi_{H-p-q-1}^{2}\)</span>–distribution where one has to choose <span class="math inline">\(H\)</span> “large enough” for this (asymptotic) distribution to be valid.</p></li>
<li><p>In practice, <span class="math inline">\(H\)</span> is chosen somewhere around 10–20 depending on the sample size <span class="math inline">\(T\)</span>. Moreover, typically a couple of different selections of <span class="math inline">\(H\)</span> are considered to see whether the testing results are similar for different selections.</p></li>
</ul>
<p>&nbsp;</p>
<p><strong>Possible (remaining) nonlinearities</strong>. Although the errors of the chosen model could be considered to have no autocorrelation, they are not necessarily independent. In line with earlier discussion on possible nonlinearities, one but clearly restricted way of investigating potential nonlinear dependencies in the errors is to use autocorrelations of the squared residuals.</p>
<p>It can be shown that when errors satisfy the assumption <span class="math inline">\(u_{t}\sim\mathsf{nid}\left(  0,\sigma^{2}\right)\)</span>, the sample autocorrelation coefficients of the squared residuals <span class="math inline">\(\widehat{u}_{t}^{2}\)</span>&nbsp;(<span class="math inline">\(t=1,\ldots.,T\)</span>) are approximately independent and <span class="math inline">\(\mathsf{N}\left(  0,1/T\right)\)</span>–distributed. Therefore, to sample autocorrelation coefficients of squared residuals <span class="math inline">\(\widehat{u}_{t}^{2}\)</span>, one can apply the critical bounds <span class="math inline">\(\pm1.96/\sqrt{T}\)</span>&nbsp;as well as the <strong>McLeod-Li test</strong> presented (that is, Ljung-Box test applied to squared residuals). <!--without the need of the lag $H$\ being too large.  --></p>
<!-- (As a remark, McLeod and Li have shown these results to hold even when only assumptions $u_{t}\sim\mathsf{iid}\left(0,\sigma^{2}\right)$ and $\mathsf{E}\left(u_{t}^{8}\right)<\infty$ hold.) -->
<ul>
<li><p>If one notices that the errors are not autocorrelated, but that their squares are autocorrelated, one can also conclude that the errors can not be Gaussian (for Gaussian processes, being not autocorrelated is equivalent with being independent). Although the asymptotic results of the estimators presented in the previous section do hold even without the normality of the errors, it is still useful to investigate how realistic the normality assumption is by checking the histogram of the residuals or using quantile-quantile plot.</p></li>
<li><p>If the errors are only serially uncorrelated, but not independent, the covariance matrix of the maximum likelihood estimator <span class="math inline">\(\boldsymbol{\widehat{\boldsymbol{\beta}}}\)</span> is not necessarily the one given in parameter estimation section. The consistency and asymptotic normality of <span class="math inline">\(\boldsymbol{\widehat{\boldsymbol{\beta}}}\)</span> can still hold under more general assumptions, but the estimated standard errors or test statistics are not necessarily valid.</p></li>
</ul>
<p>&nbsp;</p>
<p><strong>Empirical example</strong>. Let us take a look at the sufficiency of the AR(2) model estimated for the U.S. real GDP growth series. Below we depict the residual time series from the fitted model, as well as their sample autocorrelations and histogram.</p>
<ul>
<li><p>It turns out that there is no (substantial) statistically significant residual autocorrelation left in the residuals. In addition to the sample autocorrelations, the Ljung-Box test statistics for different lag lengths <span class="math inline">\(H\)</span> generally also confirm this conclusion (at least at the 5% or higher significance level).</p></li>
<li><p>As an example, the Ljung-Box test statistic gets the value <span class="math inline">\(17.546\)</span> from the first 16 lags. That is, to say, <span class="math inline">\(H=16\)</span> and the corresponding <span class="math inline">\(p\)</span>-value from the <span class="math inline">\(\chi_{13}^{2}\)</span>–distribution is <span class="math inline">\(0.176\)</span> (degrees of freedom: <span class="math inline">\(H-p-q-1=13\)</span>.</p></li>
</ul>
<p>The histogram of the residuals suggest that the normality assumption is reasonable (see bottom right). Residual histograms typically strictly matching the density function of the normal distribution (as depicted also in the figure below), but in this case the normality assumption seems relatively adequate.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Residdiag_usrealgdp.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:65.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<span style="color: #0069d9;">Figure: The residual time series of the AR(2) model estimated for the US real GDP growth series (upper figure), their estimated autocorrelation function (<span class="math inline">\(h=0,\ldots,20\)</span>, bottom left) and their histogram (bottom right).</span>
</center>
<p>&nbsp;</p>
<p>The main conclusions from residual diagnostics do not substantially change if using the AIC to select the lag length of the AR model. In the resulting AR(3) model the third lag (<span class="math inline">\(y_{t-3}\)</span>) is not statistically significant predictor in terms of its estimated t-value. Moreover, when considering ARMA(<span class="math inline">\(p,q\)</span>) models, the AIC selects MA(2) model, with essentially the same conclusions from residual diagnostics as in the AR(2) model.</p>
<p>When considering squared residuals and the McLeod-Li test statistics for different lag lengths, it turns out that basically with any lag length selection the resulting p-values are very high (typically higher than 0.50). Therefore, for the Great Moderation time period in the U.S. economy, there is no initial evidence for strong nonlinearities in the real GDP growth.</p>
<p>&nbsp;</p>
</section>
<section id="r-lab" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="r-lab"><span class="header-section-number">8.5</span> R Lab</h2>
<button class="toggle-button toggle-button-r" onclick="toggleCode('r-code8')">
R Lab, Sections 5-7: ARMA modelling
</button>
<div id="r-code8" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ARMA MODELLING</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># U.S. GDP GROWTH ANALYSIS: DETAILED SELECTION &amp; EXTENDED DIAGNOSTICS</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Final version with restored comparative model selection (AR vs. ARMA)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># and a dedicated step for the user to choose the final model.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  LOAD LIBRARIES</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>packages_to_load <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tseries"</span>, <span class="st">"forecast"</span>, <span class="st">"ggplot2"</span>, <span class="st">"readxl"</span>, <span class="st">"dplyr"</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"lubridate"</span>, <span class="st">"astsa"</span>, <span class="st">"TSA"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> packages_to_load) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  DATA ACQUISITION AND PREPARATION</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="st">"1984-10-01"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>end_date   <span class="ot">&lt;-</span> <span class="st">"2007-04-01"</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"GDPC1-qdata.xlsx"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> Date, <span class="at">value =</span> GDPC1) <span class="sc">%&gt;%</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(start_date) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(end_date))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>gdp_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(raw_data<span class="sc">$</span>value, </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">year</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>]), <span class="fu">quarter</span>(raw_data<span class="sc">$</span>date[<span class="dv">1</span>])), </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(gdp_ts)) <span class="sc">*</span> <span class="dv">400</span>  <span class="co"># Annualized growth rate</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(gdp_growth)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">#  VISUALIZATION AND MANUAL IDENTIFICATION</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gdp_growth) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"(Annualized) U.S. quarterly real GDP growth rate (1985:Q1-2007:Q2)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(gdp_growth, <span class="at">main=</span><span class="st">"ACF of GDP Growth"</span>)  <span class="co"># forecast package</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(gdp_growth, <span class="at">main=</span><span class="st">"PACF of GDP Growth"</span>) <span class="co"># forecast package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Extended Ljung-Box Test ---</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended Ljung-Box Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended Ljung-Box Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lags_to_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lb_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Lag=</span><span class="fu">integer</span>(), <span class="st">"Q-statistic"</span><span class="ot">=</span><span class="fu">double</span>(), <span class="st">"p-value"</span><span class="ot">=</span><span class="fu">double</span>())</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(gdp_growth, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, <span class="at">lag =</span> l, <span class="at">fitdf =</span> <span class="dv">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  lb_results[<span class="fu">nrow</span>(lb_results) <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(test<span class="sc">$</span>statistic, <span class="dv">3</span>), <span class="fu">round</span>(test<span class="sc">$</span>p.value, <span class="dv">3</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lb_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag Q.statistic p.value
1   4      16.487   0.002
2   8      19.494   0.012
3  12      27.942   0.006
4  16      32.897   0.008
5  20      34.679   0.022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- McLeod-Li Test ---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended McLeod-Li Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended McLeod-Li Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ml_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lag =</span> <span class="fu">integer</span>(),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_value =</span> <span class="fu">numeric</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> TSA<span class="sc">::</span><span class="fu">McLeod.Li.test</span>(<span class="at">y =</span> gdp_growth, <span class="at">gof.lag =</span> l)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> test<span class="sc">$</span>p.values[l] <span class="co"># Extract p-value for the current lag</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ml_results[<span class="fu">nrow</span>(ml_results) <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(pval, <span class="dv">3</span>)) <span class="co"># Append row: lag and p-value</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml_results) <span class="co"># This package does not print out the values of the test </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag p_value
1   4   0.342
2   8   0.564
3  12   0.533
4  16   0.688
5  20   0.717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistic (only p-values)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  DETAILED MODEL SELECTION (using Conditional MLE)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Running Detailed Model Selection ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Running Detailed Model Selection ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- (i) - Restricting to AR Models Only ---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- SCENARIO 1: AR-ONLY MODELS ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- SCENARIO 1: AR-ONLY MODELS ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ar_aic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">max.q =</span><span class="dv">0</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"aic"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best AR model selected by AIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best AR model selected by AIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ar_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(3,0,0) with non-zero mean 

Coefficients:
         ar1     ar2      ar3    mean
      0.1855  0.2976  -0.0966  3.0185
s.e.  0.1037  0.1012   0.1042  0.3184

sigma^2 = 3.458:  log likelihood = -183.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ar_bic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">max.q =</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"bic"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best AR model selected by BIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best AR model selected by BIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ar_bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(2,0,0) with non-zero mean 

Coefficients:
         ar1     ar2    mean
      0.1599  0.2872  3.0614
s.e.  0.1010  0.1015  0.3567

sigma^2 = 3.536:  log likelihood = -184.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- (ii) - Allowing ARMA Models ---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- SCENARIO 2: ARMA MODELS ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- SCENARIO 2: ARMA MODELS ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>arma_aic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"aic"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best ARMA model selected by AIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best ARMA model selected by AIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arma_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(0,0,2) with non-zero mean 

Coefficients:
         ma1     ma2    mean
      0.2047  0.2998  3.0893
s.e.  0.1031  0.0964  0.2919

sigma^2 = 3.556:  log likelihood = -183.27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>arma_bic <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(gdp_growth, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"CSS"</span>, <span class="at">ic =</span> <span class="st">"bic"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best ARMA model selected by BIC:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best ARMA model selected by BIC:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arma_bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(0,0,0) with non-zero mean 

Coefficients:
        mean
      3.1001
s.e.  0.2089

sigma^2 = 3.97:  log likelihood = -189.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  CHOOSE YOUR FINAL MODEL</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># After reviewing the 4 models above, assign your choice to 'final_model'.</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The default is the AR model selected by AIC.</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Selecting Final Model for Detailed Analysis ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Selecting Final Model for Detailed Analysis ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#final_model &lt;- ar_aic   # &lt;--- SET YOUR CHOICE HERE</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>final_model <span class="ot">&lt;-</span> ar_bic</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># final_model &lt;- arma_aic</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># final_model &lt;- arma_bic  </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  FINAL MODEL ESTIMATION AND DUAL OUTPUT</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Final Model Estimation Results ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Final Model Estimation Results ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Output with Mean (µ) ---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">VERSION 1: Model Output Reporting the MEAN (µ)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
VERSION 1: Model Output Reporting the MEAN (µ)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(final_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: gdp_growth 
ARIMA(2,0,0) with non-zero mean 

Coefficients:
         ar1     ar2    mean
      0.1599  0.2872  3.0614
s.e.  0.1010  0.1015  0.3567

sigma^2 = 3.536:  log likelihood = -184.02

Training set error measures:
                       ME     RMSE      MAE       MPE     MAPE      MASE
Training set 2.690307e-06 1.848811 1.457363 -36.02403 83.33033 0.7123962
                  ACF1
Training set 0.0254192</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Output with Constant (\nu) ---</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">VERSION 2: Model Output Reporting the CONSTANT (c)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

VERSION 2: Model Output Reporting the CONSTANT (c)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the results table from scratch</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> final_model<span class="sc">$</span>coef</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>std_errors <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(final_model<span class="sc">$</span>var.coef))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>t_values <span class="ot">&lt;-</span> estimates <span class="sc">/</span> std_errors</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(t_values))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>mean_form_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates, <span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span> <span class="ot">=</span> std_errors,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">t value</span><span class="st">`</span> <span class="ot">=</span> t_values, <span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span> <span class="ot">=</span> p_values, <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>ar_coefs <span class="ot">&lt;-</span> mean_form_table[<span class="fu">grepl</span>(<span class="st">"^ar"</span>, <span class="fu">rownames</span>(mean_form_table)), <span class="st">"Estimate"</span>]</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>mean_est <span class="ot">&lt;-</span> mean_form_table[<span class="st">"intercept"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>se_mean <span class="ot">&lt;-</span> mean_form_table[<span class="st">"intercept"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>constant_c <span class="ot">&lt;-</span> mean_est <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(ar_coefs))</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>se_constant_approx <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(ar_coefs)) <span class="sc">*</span> se_mean</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>t_val_c <span class="ot">&lt;-</span> constant_c <span class="sc">/</span> se_constant_approx</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>p_val_c <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(t_val_c))</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>constant_form_table <span class="ot">&lt;-</span> mean_form_table[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"intercept"</span>, <span class="fu">rownames</span>(mean_form_table)), ]</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>constant_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> constant_c, <span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span> <span class="ot">=</span> se_constant_approx,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">t value</span><span class="st">`</span> <span class="ot">=</span> t_val_c, <span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span> <span class="ot">=</span> p_val_c,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="st">"constant"</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>constant_form_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(constant_row, constant_form_table)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Derived Constant-Form Coefficient Table:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Derived Constant-Form Coefficient Table:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(constant_form_table, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Estimate Std. Error  t value Pr(&gt;|t|)
constant 1.692506   0.197211 8.582201 0.000000
ar1      0.159899   0.101006 1.583071 0.113405
ar2      0.287243   0.101454 2.831270 0.004636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  EXTENDED RESIDUAL DIAGNOSTICS</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------------------</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Performing Extended Residual Diagnostics on Final Model ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Performing Extended Residual Diagnostics on Final Model ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(final_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,0,0) with non-zero mean
Q* = 6.1896, df = 6, p-value = 0.4023

Model df: 2.   Total lags used: 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model_residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(final_model) <span class="co"># Here for ARIMA model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>resid_lagmax <span class="ot">&lt;-</span> <span class="dv">16</span> <span class="co"># Maximum lag length for residual autocorrelations and tests</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ACF without default x-axis</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(model_residuals, <span class="at">lag.max =</span> resid_lagmax, <span class="at">main =</span> <span class="st">"ACF of residuals"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually add x-axis ticks at correct positions</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span>resid_lagmax, <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span>resid_lagmax <span class="sc">*</span> <span class="fu">frequency</span>(model_residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Ljung-Box test</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>lb_test <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(model_residuals, <span class="at">lag =</span> resid_lagmax, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fitdf =</span> <span class="fu">length</span>(final_model<span class="sc">$</span>coef))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Ljung-Box test p-value:"</span>, <span class="fu">round</span>(lb_test<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Ljung-Box test p-value: 0.176 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Extended Ljung-Box Test ---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended Ljung-Box Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended Ljung-Box Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lags_to_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>lb_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Lag=</span><span class="fu">integer</span>(), <span class="st">"Q-statistic"</span><span class="ot">=</span><span class="fu">double</span>(), <span class="st">"p-value"</span><span class="ot">=</span><span class="fu">double</span>())</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(model_residuals, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, <span class="at">lag =</span> l, <span class="at">fitdf =</span> <span class="fu">length</span>(final_model<span class="sc">$</span>coef))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  lb_results[<span class="fu">nrow</span>(lb_results) <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(test<span class="sc">$</span>statistic, <span class="dv">3</span>), <span class="fu">round</span>(test<span class="sc">$</span>p.value, <span class="dv">3</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lb_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag Q.statistic p.value
1   4       1.899   0.168
2   8       6.190   0.288
3  12      15.344   0.082
4  16      17.546   0.176
5  20      23.709   0.128</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- McLeod-Li Test ---</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Extended McLeod-Li Test for multiple lags:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Extended McLeod-Li Test for multiple lags:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ml_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lag =</span> <span class="fu">integer</span>(),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_value =</span> <span class="fu">numeric</span>()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags_to_test) {</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> TSA<span class="sc">::</span><span class="fu">McLeod.Li.test</span>(<span class="at">y =</span> model_residuals, <span class="at">gof.lag =</span> l)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> test<span class="sc">$</span>p.values[l] <span class="co"># Extract p-value for the current lag</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  ml_results[<span class="fu">nrow</span>(ml_results) <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(l, <span class="fu">round</span>(pval, <span class="dv">3</span>)) <span class="co"># Append row: lag and p-value</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch7_files/figure-html/unnamed-chunk-1-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml_results) <span class="co"># This package does not print out the values of the test </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Lag p_value
1   4   0.567
2   8   0.621
3  12   0.504
4  16   0.567
5  20   0.472</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># statistic (only p-values)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>&nbsp;</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./TSE-ch6.html" class="pagination-link" aria-label="Parameter estimation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Parameter estimation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./TSE-ch8.html" class="pagination-link" aria-label="Forecasting with ARMA models">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>