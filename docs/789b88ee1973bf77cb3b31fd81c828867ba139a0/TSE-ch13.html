<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Linear regressions with I(1) variables – Time Series Econometrics (TSE)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./TSE-ch12.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<!-- Use JavaScript to Disable Right-Click -->
<script>
document.addEventListener('contextmenu', event => event.preventDefault());
</script>

<!-- Custom JavaScript for toggling code visibility -->
<script>
function toggleCode(id) {
  var x = document.getElementById(id);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>


<!-- Visibility selections. display: none;? 
  <style>

/* Initially hide elements */
.marginnotevideo {
  display: none;
}

.marginnote {
  display: none;
}

  </style>
-->

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles-TSE.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./TSE-ch13.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Linear regressions with I(1) variables</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Time Series Econometrics (TSE)</a> 
        <div class="sidebar-tools-main">
    <a href="./msTSE2025.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A primer on time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ARMA processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Parameter estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model selection of ARMA model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Forecasting with ARMA models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Volatility modelling: AR-GARCH model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Multivariate time series models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basics of vector autoregression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Nonstationary processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TSE-ch13.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Linear regressions with I(1) variables</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#basics-of-cointegration" id="toc-basics-of-cointegration" class="nav-link active" data-scroll-target="#basics-of-cointegration"><span class="header-section-number">13.1</span> Basics of cointegration</a></li>
  <li><a href="#testing-cointegration-between-two-variables" id="toc-testing-cointegration-between-two-variables" class="nav-link" data-scroll-target="#testing-cointegration-between-two-variables"><span class="header-section-number">13.2</span> Testing cointegration between two variables</a></li>
  <li><a href="#linear-regressions-containing-i1-variables" id="toc-linear-regressions-containing-i1-variables" class="nav-link" data-scroll-target="#linear-regressions-containing-i1-variables"><span class="header-section-number">13.3</span> Linear regressions containing I(1) variables</a></li>
  <li><a href="#r-lab" id="toc-r-lab" class="nav-link" data-scroll-target="#r-lab"><span class="header-section-number">13.4</span> R Lab</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="part-ch13" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Linear regressions with I(1) variables</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Instead of stationary variables, as considered earlier in Section 10, let us now assume that there are two variables, <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span>, and either of them or both are nonstationary and specifically <span class="math inline">\(I(1)\)</span> variables.</p>
<ul>
<li><span class="math inline">\(y_t\)</span> is again the dependent variable and <span class="math inline">\(x_t\)</span> is the predictive/explanatory variable</li>
</ul>
<!-- - In general, when considering a linear regression model between $y_t$ and $x_t$, the OLS estimator $\widehat{\boldsymbol{\beta}}$ is not generally consistent estimator for the parameter vector. -->
<p>Before continuing to examine linear (predictive) regressions between <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> in different cases, let us introduce an important concept of cointegration.</p>
<p>&nbsp;</p>
<section id="basics-of-cointegration" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="basics-of-cointegration"><span class="header-section-number">13.1</span> Basics of cointegration</h2>
<p>An important special case of the linear regression between <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span>, where <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are nonstationary <span class="math inline">\(I(1)\)</span> variables, arises when there is a common stochastic trend in both series.</p>
<p>In other words, suppose that there is a linear relationship between variables so that there exists some value <span class="math inline">\(\delta\)</span> such that <span class="math inline">\(y_t - \delta x_t\)</span> is stationary (<span class="math inline">\(I(0)\)</span>) although <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are nonstationary (<span class="math inline">\(I(1)\)</span>).</p>
<ul>
<li>In such case, it is said that <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are <strong>cointegrated</strong> and they share the common trend.</li>
</ul>
<p>In principle, an alternative way to construct a linear regression model, when <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are <span class="math inline">\(I(1)\)</span>, is based on the differences <span class="math inline">\(\Delta y_t\)</span> and <span class="math inline">\(\Delta x_t\)</span> which are then stationary (<span class="math inline">\(I(0)\)</span>).</p>
<ul>
<li><p>This is not an optimal strategy if there is indeed a cointegration relationship between the variables.</p></li>
<li><p>Cf. the discussion on overdifferencing in Section 12.</p></li>
</ul>
<p>&nbsp;</p>
<p>Let us examine cointegration more detail. <strong>If <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are <span class="math inline">\(I(1)\)</span> and cointegrated</strong>, then <span class="math display">\[\begin{equation*}
z_t= y_t - \delta x_t = [y_t \quad x_t] [1 \quad -\delta]^{\prime} \thicksim I(0).
\end{equation*}\]</span> The vector <span class="math inline">\([1 \quad -\delta]^{\prime}\)</span> is called the <strong>cointegration vector</strong>.</p>
<ul>
<li><p>Cointegration is often interpreted as a long-run relationship between the variables. Assume that the equilibrium of the variables <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> is defined by the relationship <span class="math inline">\(y_t= \tilde{\delta} x_t\)</span> for some fixed <span class="math inline">\(\tilde{\delta}\)</span>. Then <span class="math inline">\(\widehat{z}_t= y_t - \widehat{\delta} x_t\)</span> is the “equilibrium error” which measures the extent <span class="math inline">\(y_t\)</span> deviates from its “equilibrium value”.</p></li>
<li><p>As <span class="math inline">\(z_t\)</span> is <span class="math inline">\(I(0)\)</span>, the equilibrium error is stationary and fluctuating around zero. In other words, on average, the system is in equilibrium.<br>
&nbsp;</p></li>
</ul>
<p>Notice that we can also use a slightly modified definition of cointegration for the above, especially when there will be more than two variables involved. We will consider this definition, and cointegration in connection to the VAR model more detail in the <strong>Advanced Time Series Econometrics course</strong>.<br>
<!-- (Lutkepohl's definition). --></p>
<!-- [TSEK. Periaatteessa kai seuraavaa määritelmää ei ehkä tarvittaisi tällä kurssilla (JOS VECM-mallia ei esitellä) ja jäisi ATSE:n puolelle. Voi vaan sotkea tilannetta kun muuten yi on nyt esitetty y_t:n ja x_t:n välillä] 

**A slightly modified definition of cointegration** where all the variables are included in vector $\boldsymbol{y}_t = (y_{1t},\ldots, y_{nt})$ (such as both $y_t$ and $x_t$ above): The $I(d)$ process $\boldsymbol{y}_t = (y_{1t},\ldots, y_{nt})$ (where $n$ can be larger than 2 as above) is called **cointegrated** if there is a linear combination $\boldsymbol{\beta}^{\prime} \boldsymbol{y}_t$ with $\boldsymbol{\beta} \neq \boldsymbol{0}$ which is integrated of order less than $d$.

- In a typical case, $\boldsymbol{y}_t \thicksim I(1)$ and hence the `order less than $d$' implies $I(0)$. 

- A consequence of this definition is that if there is just one $I(d)$ component in $y_t$ and all the other components are stable (= $I(0)$), then the vector $\boldsymbol{y}_t$ is $I(d)$ and $\boldsymbol{\beta}^{\prime} \boldsymbol{y}_t$ involves a cointegration relation according to this definition.

-->
<p>&nbsp;</p>
</section>
<section id="testing-cointegration-between-two-variables" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="testing-cointegration-between-two-variables"><span class="header-section-number">13.2</span> Testing cointegration between two variables</h2>
<p>From the discussion above, it is obvious that it is important to distinguish whether there is a cointegration relationship between the variables.</p>
<p>Consider a “cointegration regression” between two <span class="math inline">\(I(1)\)</span> variables <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span>: <span class="math display">\[\begin{equation*}
y_t= \alpha + \delta x_t + u_t.
\end{equation*}\]</span> If <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are cointegrated, then <span class="math inline">\(u_t\)</span> is <span class="math inline">\(I(0)\)</span>. If not, <span class="math inline">\(u_t\)</span> will be <span class="math inline">\(I(1)\)</span>. Therefore, after the model is estimated by OLS, the presence of a possible cointegration relationship can be evaluated by testing for a unit root in the residuals <span class="math inline">\(\widehat{u}_t\)</span>.</p>
<p>&nbsp;</p>
<p><strong>Testing for cointegration with a known coefficient</strong>. In some applications, the cointegration coefficient <span class="math inline">\(\delta\)</span> (and the intercept <span class="math inline">\(\alpha\)</span>) is known in advance due to economic theory or other application-specific knowledge. When the coefficient is known, the cointegration relationship can be tested as follows. For the sake of simplicity, we will assume <span class="math inline">\(\alpha=0\)</span> in the procedure described below</p>
<ul>
<li><p>Construct the series <span class="math inline">\(z_t = y_{t} - \delta x_t\)</span>.</p></li>
<li><p>Use the ADF test for the null hypothesis, which implies <span class="math inline">\(z_t \thicksim I(1)\)</span>. If <span class="math inline">\(H_0\)</span> is rejected, then there is a cointegration relationship.</p></li>
</ul>
<p>&nbsp;</p>
<p><strong>Testing for cointegration with unknown coefficients</strong>. If <span class="math inline">\(\delta\)</span> (and <span class="math inline">\(\alpha\)</span>) are unknown, then we can proceed as follows (Engle-Granger ADF-test):</p>
<ul>
<li><p>Estimate the following model by using OLS <span class="math display">\[\begin{equation*}
y_t = \alpha + \delta x_t + u_t.
\end{equation*}\]</span></p></li>
<li><p>The series <span class="math inline">\(\widehat{u}_t= y_t - \widehat{\alpha} - \widehat{\delta} x_t\)</span> is the residual of the regression.</p></li>
<li><p>Test the null hypothesis implying <span class="math inline">\(\widehat{u}_t \thicksim I(1)\)</span>.</p></li>
<li><p>Critical values are now different than in the above case (and ADF test) as unit root testing is based on the residuals.</p></li>
</ul>
<p>&nbsp;</p>
<p>If <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are indeed cointegrated, OLS yields a consistent estimator for the cointegration coefficient <span class="math inline">\(\delta\)</span>. However, the OLS estimator of <span class="math inline">\(\delta\)</span> has a non-normal asymptotic distribution, and the inferences based on the standard <span class="math inline">\(t\)</span>-test statistic can be misleading.</p>
<p>&nbsp;</p>
<p><strong>Example: Consumption and income</strong>. Let us consider an important empirical question derived from Hall’s (1978) Permanent Income Hypothesis (PIH) in the context of cointegration.</p>
<ul>
<li>R. E. Hall (1978). Stochastic implications of the life cycle-permanent income hypothesis: Theory and evidence. Journal of Political Economy, 86(6), 971–987.</li>
</ul>
<p>The testable hypothesis is that there is a stable long-run relationship exist between real consumption and real income, such that the difference between them (the cointegrating residual) is stationary.</p>
<ul>
<li>In other words, the cointegration theory predicts that since consumption is proportional to permanent income (the present value of expected future income), and both are driven by a common stochastic trend (permanent income shocks), they should be cointegrated.</li>
</ul>
<!-- - In other words, one can think that consumption $c_t$ is related to the income $y_t$ so that $c_t=a \, y_t, \, 0 \le a \le 1$. Therefore, it seems reasonable to assume that there is a long-term equilibrium between $c_t$ and $y_t$. If $c_t$ and $y_t$ are now $I(1)$ processes, then there should be a cointegration relationship between the variables. -->
<p>So, let us test the prediction of the PIH that real per capita consumption (log(<span class="math inline">\(c_t\)</span>) and real per capita disposable income (log(<span class="math inline">\(y_t\)</span>) share a single cointegrating relationship.</p>
<ul>
<li><p>Hypothesis: The two variables (<span class="math inline">\(\log(c_t)\)</span> and <span class="math inline">\(\log(y_t)\)</span>) are <span class="math inline">\(I(1)\)</span> and cointegrated.</p></li>
<li><p>Long-run equation: <span class="math inline">\(\log(c_t) = \alpha + \delta \log(y_t) + u_t\)</span></p></li>
<li><p>PIH implication: The cointegrating vector should be <span class="math inline">\((1,-\beta_1)\)</span>, where <span class="math inline">\(\beta_1\)</span> is theoretically close to 1 (or exactly 1 in the simplest PIH model) because, in the long run, consumption should grow proportionally with permanent income. The error term <span class="math inline">\(u_t\)</span> and the resulting residuals <span class="math inline">\(\widehat{u}_t\)</span> must be <span class="math inline">\(I(0)\)</span> (stationary).</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PIHdata.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:55.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<span style="color: #0069d9;">Figure: Monthly U.S. data (sample period 1959:1–2025:8) on (log) consumption and income.</span>
</center>
<p>&nbsp;</p>
<p>Check first the unit root hypothesis for the two time series. In these ADF tests, a constant and linear trend component is included in the test regression and the number lagged differences <span class="math inline">\(p\)</span> is 4:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>log(c_t)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Test Statistic: -2.005634 </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>P-value: 0.595</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>log(y_t)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>Test Statistic: -2.582764 </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>P-value: 0.289 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Estimation result of the cointegration regression:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="an">Coefficients:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">            Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>(Intercept) 0.383122   0.044448    8.62 6.29e-16 ***</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ln_Y        1.048293   0.004244  246.99  &lt; 2e-16 ***</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Residual standard error: 0.02692 on 264 degrees of freedom</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Multiple R-squared:  0.9957,    Adjusted R-squared:  0.9957 </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>F-statistic: 6.1e+04 on 1 and 264 DF,  p-value: &lt; 2.2e-16</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Based on the Engle-Granger two-step procedure, the null hypothesis of no cointegration can be rejected at 5% level (see testing result below).</p>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="PIH_residuals.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:55.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<span style="color: #0069d9;">Figure: PIH residual time series (from the estimated cointegrated model).</span>
</center>
<p>&nbsp;</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="an">Test Statistic:</span><span class="co"> -4.561388 </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; cat("P-value:", p_val_drift, "\n")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">P-value: 0.000197051 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
</section>
<section id="linear-regressions-containing-i1-variables" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="linear-regressions-containing-i1-variables"><span class="header-section-number">13.3</span> Linear regressions containing I(1) variables</h2>
<p>Recall the linear regression <span class="math display">\[\begin{equation*}
y_t= \boldsymbol{x}^{\prime}_t \boldsymbol{\beta} + u_t,
\end{equation*}\]</span> and the two assumptions <span class="math inline">\(\mathrm{(i)}\)</span>–<span class="math inline">\(\mathrm{(ii)}\)</span> set in Section 10:</p>
<ul>
<li><p><span class="math inline">\(\mathrm{(i)}\)</span> The error term <span class="math inline">\(u_t\)</span> is serially uncorrelated and uncorrelated with the regressors included in <span class="math inline">\(\boldsymbol{x}_t\)</span>.</p></li>
<li><p><span class="math inline">\(\mathrm{(ii)}\)</span> All the regressors in <span class="math inline">\(\boldsymbol{x}_t\)</span> are either deterministic or stationary random variables.</p></li>
</ul>
<p><strong>Assume now that only <span class="math inline">\(\mathrm{(i)}\)</span> holds</strong>, that is the error term <span class="math inline">\(u_t\)</span> is serially uncorrelated and uncorrelated with the regressors included in <span class="math inline">\(\boldsymbol{x}_t\)</span>.</p>
<ul>
<li><p>Even if the model cannot be written in this way, the OLS estimator of the coefficients of the <span class="math inline">\(I(1)\)</span> regressors <span class="math inline">\(\boldsymbol{x}_t\)</span> is consistent. However, its asymptotic distribution is, in general, nonstandard such that usual inference does not apply.</p></li>
<li><p>If the model can be written such that all the parameters of interest are coefficients of mean zero stationary variables, their OLS estimator is consistent and asymptotically normal.</p></li>
</ul>
<p>To examine these points more detail, let us consider again the following relatively simple regression model <span class="math display">\[\begin{equation*}
y_t= \beta_0 + \beta_1 x_{t-1} + \beta_2 x_{t-2} + u_t,
\end{equation*}\]</span> where <span class="math inline">\(x_t \thicksim I(1)\)</span>. The model can be rewritten as <span class="math display">\[\begin{equation*}
y_t= \beta_0 + (\beta_1+\beta_2) x_{t-1} - \beta_2 (x_{t-1} - x_{t-2}) + u_t,
\end{equation*}\]</span> or <span class="math display">\[\begin{equation*}
y_t= \beta_0 + \beta_1 (x_{t-1}-x_{t-2}) + (\beta_1 + \beta_2) x_{t-2} + u_t.
\end{equation*}\]</span> As <span class="math inline">\((x_{t-1} - x_{t-2}) \thicksim I(0)\)</span>, and hence, standard inference on <span class="math inline">\(\beta_2\)</span> (or <span class="math inline">\(\beta_1\)</span>) holds. Therefore, both <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> cannot simultaneously be written as coefficients of <span class="math inline">\(I(0)\)</span> variables (unless higher lags are included in the model).</p>
<ul>
<li><p>The OLS estimator of <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> is not, in general, jointly asymptotically normal.</p></li>
<li><p>The test statistic on a hypothesis concerning both coefficients (for instance <span class="math inline">\(H_0: \beta_1 = \beta_2\)</span>), in general, does not have the usual asymptotic <span class="math inline">\(\chi^2\)</span> distribution.</p></li>
</ul>
<p>These remarks are compiled to the next figure.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="OLSregI1variables2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<center>
<span style="color: #0069d9;">Figure: Cheat sheet on inference in OLS regression models with <span class="math inline">\(I(1)\)</span> variables (References: Stock and Watson (1988) and lecture notes by Markku Lanne).</span>
</center>
<p>&nbsp;</p>
<p>Let us continue with linear regression where now also the assumption <span class="math inline">\(\mathrm{(i)}\)</span> does not hold and the dependent variable is <span class="math inline">\(I(1)\)</span>.</p>
<ul>
<li><p>If the dependent variable is not cointegrated with any of the regressors, the OLS estimator of the coefficients of the <span class="math inline">\(I(1)\)</span> regressors is inconsistent.</p></li>
<li><p>If the dependent variable is cointegrated with at least one of the regressors, the OLS estimator of the parameters of interest</p>
<ul>
<li><p>that can be written as coefficients of stationary variables, is inconsistent.</p></li>
<li><p>that cannot be written as coefficients of stationary variables, is consistent, but not asymptotically normal.</p></li>
</ul></li>
</ul>
<p>For instance, consider the following regression model: <span class="math display">\[\begin{equation*}
y_t = \beta_0 + \beta_1 x_{1t} + \beta_2 x_{2t} + u_t,
\end{equation*}\]</span> where all variables are <span class="math inline">\(I(1)\)</span>, and <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_{2t}\)</span> are cointegrated and assumption <span class="math inline">\(\mathrm{(i)}\)</span> does not hold.</p>
<ul>
<li><p>If <span class="math inline">\(x_{1t}\)</span> and <span class="math inline">\(x_{2t}\)</span> are cointegrated such that <span class="math inline">\((x_{1t} - \gamma x_{2t}) \thicksim ~ I(0)\)</span>, the model can be written as <span class="math display">\[\begin{equation*}
y_t = \beta_0 + \beta_1 (x_{1t} - \gamma x_{2t}) + (\beta_1 \gamma + \beta_2) x_{2t} + u_t,
\end{equation*}\]</span> and the OLS estimator of <span class="math inline">\(\beta_1\)</span> is inconsistent.</p></li>
<li><p>If <span class="math inline">\(x_{1t}\)</span> is not cointegrated with <span class="math inline">\(x_{2t}\)</span>, <span class="math inline">\(\beta_1\)</span> cannot be written as a coefficient of an <span class="math inline">\(I(0)\)</span> variable, and hence, its OLS estimator is consistent, but not asymptotically normal.</p></li>
</ul>
<p>&nbsp;</p>
<p>The complete <em>cheat sheet</em> on linear regression with <span class="math inline">\(I(0)\)</span> and <span class="math inline">\(I(1)\)</span> variables is summarized hereby:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="OLSregI1variables.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<span style="color: #0069d9;">Figure: Complete cheat sheet on inference in OLS regression models with <span class="math inline">\(I(1)\)</span> variables.</span>
</center>
<p>&nbsp;</p>
<p><strong>A spurious regression</strong> emerges when a statistically significant relationship between two <span class="math inline">\(I(1)\)</span> variables <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> is found although those are completely unrelated. Assume that a researcher estimates a linear regression <span class="math display">\[\begin{equation*}
y_t = \beta_0 + \beta_1 x_t + u_t,
\end{equation*}\]</span> but assuming wrongly that the variables <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are stationary. Instead, they are generated by two independent random walks (i.e., <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> are <span class="math inline">\(I(1)\)</span> variables) <span class="math display">\[\begin{eqnarray*}
y_t &amp;=&amp; y_{t-1} + u_{1t}, \quad u_{1t} \thicksim \mathsf{iid}(0, \sigma^2_1) \\
x_t &amp;=&amp; x_{t-1} + u_{2t}, \quad u_{2t} \thicksim \mathsf{iid}(0, \sigma^2_2).
\end{eqnarray*}\]</span> This typically leads to the estimation result of the above linear regression characterized by a fairly high <span class="math inline">\(R^2\)</span> (the coefficient of determination), highly autocorrelated residuals <span class="math inline">\(\widehat{u}_t\)</span> and a (highly) statistically significant estimate of <span class="math inline">\(\beta_1\)</span>. This result is clearly spurious given that the variables are completely independent!</p>
<ul>
<li><p>Estimation results like this should not be taken seriously.</p></li>
<li><p>The reason is that with <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> being <span class="math inline">\(I(1)\)</span> variables, the error term <span class="math inline">\(u_t\)</span> will also be <span class="math inline">\(I(1)\)</span>, not stationary (<span class="math inline">\(I(0)\)</span>).</p></li>
</ul>
<p>Solution to this problem is to include both the lags of <span class="math inline">\(y_t\)</span> and <span class="math inline">\(x_t\)</span> as predictors in the model. In other words, we end up a model <span class="math display">\[\begin{equation*}
y_t = \beta_0 + \beta_1 x_t + \beta_2 y_{t-1} + \beta_3 x_{t-1} +  u_t.
\end{equation*}\]</span> In this case the OLS estimator is consistent. Thus, in general, including lagged values in the regression is sufficient to solve many of the problems associated with possibly spurious regressions.</p>
<p>An example of a spurious regression situation can be replicated with the following program code below in R lab.</p>
<p>&nbsp;</p>
</section>
<section id="r-lab" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="r-lab"><span class="header-section-number">13.4</span> R Lab</h2>
<p>All the R codes considered in this section are compiled in the following link:</p>
<button class="toggle-button toggle-button-r" onclick="toggleCode('r-code14')">
R Lab: Cointegration (PIH example)
</button>
<div id="r-code14" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("quantmod", "tseries")) # Uncomment and run if not installed</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch and Prepare Data</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Fetch Data from FRED (Corrected Income Code: DPIC96)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># PCECC96: Real Personal Consumption Expenditures</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># DPIC96: Real Disposable Personal Income</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># POPTHM: Population (Thousands)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>PCECC96 <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"PCECC96"</span>, <span class="at">src =</span> <span class="st">"FRED"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>DPIC96 <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"DPIC96"</span>, <span class="at">src =</span> <span class="st">"FRED"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>POPTHM <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"POPTHM"</span>, <span class="at">src =</span> <span class="st">"FRED"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Align and Transform Data (Log, Per Capita, Quarterly)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge series and remove any periods with missing data</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>data.raw <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">merge</span>(PCECC96, DPIC96, POPTHM))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to 'ts' object with quarterly frequency</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>start.year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">index</span>(<span class="fu">head</span>(data.raw, <span class="dv">1</span>)), <span class="st">"%Y"</span>))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>data.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(data.raw, <span class="at">start =</span> start.year, <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate real, per capita, log-transformed variables</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>POP_THOUSANDS <span class="ot">&lt;-</span> data.ts[, <span class="st">"POPTHM"</span>]</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>POP <span class="ot">&lt;-</span> POP_THOUSANDS <span class="sc">*</span> <span class="dv">1000</span> <span class="co"># Convert from thousands to single units</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Log Per Capita Consumption (ln_C)</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>ln_C <span class="ot">&lt;-</span> <span class="fu">log</span>(data.ts[, <span class="st">"PCECC96"</span>] <span class="sc">/</span> POP)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Log Per Capita Income (ln_Y)</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>ln_Y <span class="ot">&lt;-</span> <span class="fu">log</span>(data.ts[, <span class="st">"DPIC96"</span>] <span class="sc">/</span> POP)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the Variables</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the plotting window to display all three graphs</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fl">0.1</span>) </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot 1: Population ---</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(POP_THOUSANDS, </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"U.S. Population (POPTHM)"</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"darkgreen"</span>, </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Observation: Population shows a clear deterministic and stochastic trend (non-stationary).</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot 2: Log Per Capita Real Consumption (ln_C) ---</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ln_C, </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Log Real Per Capita Consumption (ln C)"</span>,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"ln(Consumption)"</span>,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"blue"</span>, </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Observation: ln_C shows a strong upward trend, typical of an I(1) process.</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot 3: Log Per Capita Real Disposable Income (ln_Y) ---</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ln_Y, </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Log Real Per Capita Disposable Income (ln Y)"</span>,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"ln(Income)"</span>,</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch13_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observation: ln_Y also shows a strong upward trend. Visually, ln_C and ln_Y </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># appear to move together, suggesting a common stochastic trend, a prerequisite for cointegration.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset plot layout</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, plot the two log series together to visually confirm they share a trend</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Visual Cointegration Check (Overlay) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Visual Cointegration Check (Overlay) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ln_C, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Log Per Capita Consumption (Blue) vs. Income (Red)"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Log Value"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"blue"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">c</span>(ln_C, ln_Y)))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ln_Y, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"ln C (Consumption)"</span>, <span class="st">"ln Y (Income)"</span>), </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch13_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Unit Root Pre-Checks (Confirm I(1) for both)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("\n--- ADF Test on LOG(Consumption) Levels (ln_C) ---\n")</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(adf.test(ln_C, k = 4)) # k=4 for quarterly data is a common starting point</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ADF-test: Constant and trend</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>adf_lags <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- ur.df() | type = 'trend' ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- ur.df() | type = 'trend' ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>test_ur_trend <span class="ot">&lt;-</span> <span class="fu">ur.df</span>(ln_C, <span class="at">type =</span> <span class="st">"trend"</span>, <span class="at">lags =</span> adf_lags)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>stat_trend <span class="ot">&lt;-</span> test_ur_trend<span class="sc">@</span>teststat[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>p_val_trend <span class="ot">&lt;-</span> <span class="fu">punitroot</span>(<span class="at">q =</span> stat_trend, <span class="at">N =</span> <span class="fu">length</span>(test_ur_trend<span class="sc">@</span>res), <span class="at">trend =</span> <span class="st">"ct"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test Statistic:"</span>, stat_trend, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Statistic: -2.005634 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"P-value:"</span>, p_val_trend, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P-value: 0.5951187 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("\n--- ADF Test on LOG(Income) Levels (ln_Y) ---\n")</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(adf.test(ln_Y, k = 4))</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # </span><span class="al">NOTE</span><span class="co">: If p-value is &gt; 0.05 for both, the I(1) condition is met to proceed.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ADF-test: Constant and trend</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>adf_lags <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- ur.df() | type = 'trend' ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- ur.df() | type = 'trend' ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>test_ur_trend <span class="ot">&lt;-</span> <span class="fu">ur.df</span>(ln_Y, <span class="at">type =</span> <span class="st">"trend"</span>, <span class="at">lags =</span> adf_lags)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>stat_trend <span class="ot">&lt;-</span> test_ur_trend<span class="sc">@</span>teststat[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p_val_trend <span class="ot">&lt;-</span> <span class="fu">punitroot</span>(<span class="at">q =</span> stat_trend, <span class="at">N =</span> <span class="fu">length</span>(test_ur_trend<span class="sc">@</span>res), <span class="at">trend =</span> <span class="st">"ct"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test Statistic:"</span>, stat_trend, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Statistic: -2.582764 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"P-value:"</span>, p_val_trend, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P-value: 0.2886401 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The Engle-Granger Cointegration Test</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===============================================</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the Long-Run Relationship (The Cointegrating Regression)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model: ln_C = alpha + beta * ln_Y + epsilon</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>cointegrating_regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(ln_C <span class="sc">~</span> ln_Y)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Cointegrating Regression (ln_C ~ ln_Y) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Cointegrating Regression (ln_C ~ ln_Y) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(cointegrating_regression))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ln_C ~ ln_Y)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.222565 -0.011066  0.001933  0.013846  0.049964 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.383122   0.044448    8.62 6.29e-16 ***
ln_Y        1.048293   0.004244  246.99  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.02692 on 264 degrees of freedom
Multiple R-squared:  0.9957,    Adjusted R-squared:  0.9957 
F-statistic: 6.1e+04 on 1 and 264 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the residual series (the potential long-run equilibrium error)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">residuals</span>(cointegrating_regression), <span class="at">start =</span> start.year, <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the residuals (to visually check for stationarity)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The time indexing (year and quarters) is correctly inherited from the 'ln_C' and 'ln_Y' ts objects</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resids, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals from cointegrating regression (Engle-Granger residual)"</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residual"</span>, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"purple"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch13_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observation: If the series appears mean-reverting around zero, it visually supports stationarity (I(0)).</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3b. Test the Residuals for Stationarity (The Cointegration Test)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Null Hypothesis (H0): Residuals are Non-Stationary (No cointegration)</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative (HA): Residuals are Stationary (Cointegration exists)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Case 2: Constant (drift) only</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- ur.df() | type = 'drift' ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- ur.df() | type = 'drift' ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>test_ur_drift <span class="ot">&lt;-</span> <span class="fu">ur.df</span>(resids, <span class="at">type =</span> <span class="st">"drift"</span>, <span class="at">lags =</span> adf_lags)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>stat_drift <span class="ot">&lt;-</span> test_ur_drift<span class="sc">@</span>teststat[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>p_val_drift <span class="ot">&lt;-</span> <span class="fu">punitroot</span>(<span class="at">q =</span> stat_drift, <span class="at">N =</span> <span class="fu">length</span>(test_ur_drift<span class="sc">@</span>res), <span class="at">trend =</span> <span class="st">"c"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test Statistic:"</span>, stat_drift, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Statistic: -4.561388 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"P-value:"</span>, p_val_drift, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P-value: 0.000197051 </code></pre>
</div>
</div>
</div>
<button class="toggle-button toggle-button-r" onclick="toggleCode('r-code15')">
R Lab: Spurious regression simulation
</button>
<div id="r-code15" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spurious regression</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup: Set length (T) and simulate innovations (epsilon)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>) <span class="co"># For reproducibility</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>epsilon_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>epsilon_2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Simulate two independent Random Walks (I(1) processes)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative sum creates the random walk (y_t = y_{t-1} + epsilon_t)</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(epsilon_1)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(epsilon_2)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Plot the random walks (to show non-stationarity)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(2, 1))</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(y, type="l", main="Random Walk y")</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(x, type="l", main="Random Walk x")</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(1, 1))</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Estimate Spurious Regression (y on x)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>estim_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- Spurious Regression Summary (y ~ x) ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- Spurious Regression Summary (y ~ x) ---"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(estim_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.7504  -2.9024  -0.0052   3.0015  11.1311 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.91838    0.24019  -7.987 9.66e-15 ***
x            0.28525    0.01399  20.394  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.974 on 498 degrees of freedom
Multiple R-squared:  0.4551,    Adjusted R-squared:  0.454 
F-statistic: 415.9 on 1 and 498 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Analyze Spurious Regression Residuals (should look non-stationary/autocorrelated)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>resid_1 <span class="ot">&lt;-</span> <span class="fu">resid</span>(estim_model)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- ACF of Spurious Regression Residuals ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- ACF of Spurious Regression Residuals ---"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(resid_1, <span class="at">main=</span><span class="st">"ACF of Spurious Regression Residuals"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch13_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Optional: Augmented Regression (with lags)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare lagged variables (removes the first observation)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>y_lag1 <span class="ot">&lt;-</span> y[<span class="dv">1</span><span class="sc">:</span>(T<span class="dv">-1</span>)]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>x_lag1 <span class="ot">&lt;-</span> x[<span class="dv">1</span><span class="sc">:</span>(T<span class="dv">-1</span>)]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>y_t <span class="ot">&lt;-</span> y[<span class="dv">2</span><span class="sc">:</span>T]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>x_t <span class="ot">&lt;-</span> x[<span class="dv">2</span><span class="sc">:</span>T]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>estim_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_t <span class="sc">~</span> x_t <span class="sc">+</span> x_lag1 <span class="sc">+</span> y_lag1)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- Augmented Regression Summary (y_t ~ x_t + x_{t-1} + y_{t-1}) ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- Augmented Regression Summary (y_t ~ x_t + x_{t-1} + y_{t-1}) ---"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(estim_model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_t ~ x_t + x_lag1 + y_lag1)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.91745 -0.63821  0.01122  0.66164  2.98589 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.089030   0.062250  -1.430    0.153    
x_t         -0.007609   0.042138  -0.181    0.857    
x_lag1       0.013689   0.042090   0.325    0.745    
y_lag1       0.975694   0.011006  88.648   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9692 on 495 degrees of freedom
Multiple R-squared:  0.9677,    Adjusted R-squared:  0.9675 
F-statistic:  4943 on 3 and 495 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>resid_2 <span class="ot">&lt;-</span> <span class="fu">resid</span>(estim_model_2)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- ACF of Spurious Regression Residuals With Lags ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- ACF of Spurious Regression Residuals With Lags ---"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(resid_2, <span class="at">main=</span><span class="st">"ACF of Spurious Regression Residuals"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TSE-ch13_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./TSE-ch12.html" class="pagination-link" aria-label="Nonstationary processes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Nonstationary processes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>